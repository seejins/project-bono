import{e as Ie,r as j,g as at,F as G,l as st,o as P,j as t,p as nt,b as rt,q as it,k as ot,B as _e,R as Q,n as lt,m as se,A as ct,D as dt}from"./index-446XYAQp.js";import{g as mt,a as De,X as Fe,Y as Ae,f as pt,T as ut,B as pe,R as xt,C as ft,b as ht,L as gt,c as bt,d as _t,D as Te}from"./BaseLineChart-Db_YwLwK.js";import{T as Ee,Z as yt}from"./zap-Cv4-16MV.js";import"./tiny-invariant-CH88cG8v.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=Ie("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=Ie("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);var kt=mt({chartName:"BarChart",GraphicalChild:De,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:Fe},{axisType:"yAxis",AxisComp:Ae}],formatAxisMap:pt});const vt={raceData:null,sessions:[],defaultSessionId:null,loading:!0,error:null},wt=(e,n)=>{const[l,p]=j.useState(vt);return j.useEffect(()=>{const r=new AbortController;return(async()=>{p(b=>({...b,loading:!0,error:null}));try{const b=at(),x={signal:r.signal},[d,_]=await Promise.all([fetch(`${b}/api/races/${n}`,x),fetch(`${b}/api/races/${n}/results`,x)]);let m=null;if(d.ok){const c=await d.json();m=(c==null?void 0:c.race)??null}if(!_.ok){const c=await _.text();throw new Error(`Failed to fetch race data: ${_.status} ${c}`)}const y=await _.json(),w=Array.isArray(y.sessions)?y.sessions:[];if(w.length===0)throw new Error("No session data found for this race");const g=Mt(w,e),T=w.map((c,$)=>{const K=(c==null?void 0:c.sessionType)??(c==null?void 0:c.session_type)??0,I=Number(K)||0,s=G.getSessionTypeName(I),C=(c==null?void 0:c.id)??(c==null?void 0:c.sessionId)??(c==null?void 0:c.session_id)??(c==null?void 0:c.session_result_id)??`${n}-${I}-${$}`,A=String(C),E=(c==null?void 0:c.sessionName)??(c==null?void 0:c.session_name)??s,S=Array.isArray(c==null?void 0:c.results)?c.results:[],f=S.find(B=>$t(B,g));let o=null,M=[],U=S;if(f){o=Ct(f);const{lapData:B,sessionDrivers:H}=Tt(o,S);M=B,U=H}return{sessionId:A,sessionType:I,sessionName:E,sessionTypeName:s,driver:o,lapData:M,sessionDrivers:U}});if(!T.some(c=>c.driver)){const c=g.driverName!=null,$=T.map(K=>K.sessionName||K.sessionTypeName).join(", ");throw c?new Error(`Driver with id ${e} (json_driver_name: ${g.driverName}) not found in any session results. Available sessions: ${$}. The driver may not exist in this race or json_driver_name may not match.`):new Error(`Driver with id ${e} not found. Missing json_driver_name for cross-session matching. Available sessions: ${$}`)}const k=T.find(c=>c.sessionType===10&&c.driver)||T.find(c=>c.driver)||T[0]||null;r.signal.aborted||p({raceData:m,sessions:T,defaultSessionId:k?k.sessionId:null,loading:!1,error:null})}catch(b){if(r.signal.aborted)return;p(x=>({...x,loading:!1,error:(b==null?void 0:b.message)??"Failed to load driver race data"}))}})(),()=>{r.abort()}},[e,n]),l},Ct=e=>{var d,_,m;const n=Lt(e.additional_data),l=ee((e==null?void 0:e.driver_session_result_id)??(e==null?void 0:e.driverSessionResultId)??(e==null?void 0:e.id)??(e==null?void 0:e.session_result_id)??(e==null?void 0:e.sessionResultId)),p=e.user_id!=null?String(e.user_id):null,v=e.driver_name||e.mapping_driver_name||((d=n==null?void 0:n.participantData)==null?void 0:d.name)||null||e.json_driver_name||"Unknown Driver",b=ee((e==null?void 0:e.driver_session_result_id)??(e==null?void 0:e.driverSessionResultId)??(e==null?void 0:e.id)??null),x=p??(e.json_driver_id!=null?String(e.json_driver_id):null)??(e.driver_id!=null?String(e.driver_id):null)??(((_=n==null?void 0:n.participantData)==null?void 0:_.driverId)!=null?String((m=n==null?void 0:n.participantData)==null?void 0:m.driverId):null);return{id:b??l??`driver-${(e==null?void 0:e.driver_session_result_id)??(e==null?void 0:e.id)??"unknown"}`,name:v,sessionResultId:b??l??null,canonicalDriverId:x??null,mappedUserId:p,team:e.json_team_name||e.mapping_team_name||e.driver_team||"Unknown Team",number:e.json_car_number||e.driver_number||e.mapping_driver_number||e.position||0,additional_data:n,additionalData:n,racePosition:e.position!=null?Number(e.position):void 0,_totalRaceTimeMs:e.total_race_time_ms!=null?Number(e.total_race_time_ms):void 0,raceLapTime:e.best_lap_time_ms!=null?Number(e.best_lap_time_ms):void 0,raceBestLapTime:e.best_lap_time_ms!=null?Number(e.best_lap_time_ms):void 0,raceSector1Time:e.sector1_time_ms!=null?Number(e.sector1_time_ms):void 0,raceSector2Time:e.sector2_time_ms!=null?Number(e.sector2_time_ms):void 0,raceSector3Time:e.sector3_time_ms!=null?Number(e.sector3_time_ms):void 0,points:e.points!=null?Number(e.points):0,fastestLap:e.fastest_lap===!0||e.fastest_lap==="true"||e.fastest_lap===1,fastestLapTime:e.best_lap_time_ms!=null?Number(e.best_lap_time_ms):void 0,status:St(e.result_status),gridPosition:e.grid_position!=null?Number(e.grid_position):void 0,penalties:e.penalties!=null?Number(e.penalties):0,postRacePenalties:e.post_race_penalties!=null?Number(e.post_race_penalties):0,totalPenalties:(e.penalties||0)+(e.post_race_penalties||0),penaltyReason:e.penalty_reason||e.all_penalty_reasons||null,warnings:e.warnings!=null?Number(e.warnings):0,dnf:!!(e.result_status===4||e.result_status===7||e.dnf_reason),dnfReason:e.dnf_reason,lap_times:e.lap_times||[],dataSource:"FILE_UPLOAD",raceGap:null,raceTime:e.total_race_time_ms!=null?G.formatTimeFromMs(Number(e.total_race_time_ms)):"--:--.---"}},Lt=e=>{if(!e)return null;if(typeof e=="string")try{return JSON.parse(e)}catch{return{}}return e},St=e=>{switch(String(e)){case"2":return"finished";case"4":case"7":return"dnf";case"5":return"dsq";case"6":return"dnq";default:return"finished"}},Tt=(e,n)=>{const l=n||[];if(!e.lap_times||e.lap_times.length===0)return{lapData:[],sessionDrivers:l};const p=[...e.lap_times].sort((d,_)=>(d.lap_number||0)-(_.lap_number||0)),r=new Map;let v=0;p.forEach(d=>{d.lap_time_ms&&d.lap_time_ms>0&&(v+=d.lap_time_ms,r.set(d.lap_number,v))});const b=new Map;return l.forEach(d=>{if(d.id===e.id)return;const _=d.lap_times||[];if(_.length===0)return;const m=[..._].sort((g,T)=>(g.lap_number||0)-(T.lap_number||0)),y=new Map;let w=0;m.forEach(g=>{g.lap_time_ms&&g.lap_time_ms>0&&(w+=g.lap_time_ms,y.set(g.lap_number,w))}),b.set(d.id,y)}),{lapData:p.map(d=>{if(!d.lap_time_ms||d.lap_time_ms<=0)return d;const _=d.lap_number,m=r.get(_)||0;let y=1/0;b.forEach(k=>{const c=k.get(_);c!==void 0&&c>0&&c<y&&(y=c)}),m>0&&m<=y&&(y=m);let w=1/0;const g=d.track_position;g&&g>1&&l.forEach(k=>{if(k.id===e.id)return;const $=(k.lap_times||[]).find(I=>I.lap_number===_);if(($==null?void 0:$.track_position)===g-1){const I=b.get(k.id);if(I){const s=I.get(_);s!==void 0&&s>0&&s<w&&(w=s)}}});const T=y!==1/0&&m>0&&m>y?m-y:null,h=w!==1/0&&m>0&&m>w?m-w:null;return{...d,gap_to_leader_ms:T,gap_to_position_ahead_ms:h}}),sessionDrivers:l}},Mt=(e,n)=>{const l=n?String(n):null,p=It(e,l);if(p){const{result:r}=p,v=ye(r),b=ee((r==null?void 0:r.mapped_user_id)??(r==null?void 0:r.mappedUserId)??(r==null?void 0:r.user_id)??(r==null?void 0:r.userId)),x=ee((r==null?void 0:r.json_driver_name)??(r==null?void 0:r.jsonDriverName)??(r==null?void 0:r.driver_name)??(r==null?void 0:r.mapping_driver_name)??(r==null?void 0:r.name),!0);return{driverId:l,sessionResultId:v??l,mappedUserId:b,jsonDriverId:ee((r==null?void 0:r.json_driver_id)??(r==null?void 0:r.jsonDriverId)),driverName:x,carNumber:ee((r==null?void 0:r.json_car_number)??(r==null?void 0:r.driver_number)??(r==null?void 0:r.number))}}return st.error("Could not find driver with id:",l),{driverId:l,sessionResultId:l,mappedUserId:null,jsonDriverId:null,driverName:null,carNumber:null}},$t=(e,n)=>{if(!e||!n)return!1;const l=ye(e);if(n.sessionResultId&&l&&l===n.sessionResultId)return!0;if(n.driverName){const p=ee((e==null?void 0:e.json_driver_name)??(e==null?void 0:e.jsonDriverName)??(e==null?void 0:e.driver_name)??(e==null?void 0:e.name),!0);if(p&&p===n.driverName)return!0}return!1},ee=(e,n=!1)=>{if(e==null)return null;const l=String(e).trim();return l?n?l.toLowerCase():l:null},ye=e=>ee((e==null?void 0:e.driver_session_result_id)??(e==null?void 0:e.driverSessionResultId)??(e==null?void 0:e.id)??(e==null?void 0:e.session_result_id)??(e==null?void 0:e.sessionResultId)),It=(e,n)=>{if(!n)return null;const l=ee(n);if(!l)return null;for(const p of e){const r=Array.isArray(p==null?void 0:p.results)?p.results:[];for(const v of r){const b=ye(v);if(b&&b===l)return{session:p,result:v}}}return null},Me=e=>{if(e==null)return null;const n=Number(e);return!Number.isFinite(n)||n<=0?null:n},Dt=e=>{const n=(e==null?void 0:e.lap_number)??(e==null?void 0:e.lapNumber);if(n==null)return null;const l=Number(n);return!Number.isFinite(l)||l<=0?null:l},he=e=>{const n=G.getTireCompoundText(e);return n?n.toUpperCase():"UNK"},ge=e=>{switch(e.toUpperCase()){case"S":return"Soft";case"M":return"Medium";case"H":return"Hard";case"I":return"Intermediate";case"W":return"Wet";default:return e.toUpperCase()}},Ft=e=>{switch((G.getTireCompoundText(e)||"").toUpperCase()){case"S":case"SOFT":return P.danger;case"M":case"MEDIUM":return P.warning;case"H":case"HARD":return P.neutral;case"I":case"INTERMEDIATE":return P.success;case"W":case"WET":return P.info;default:return P.purple}},At=e=>{if(e==null)return!1;if(typeof e=="boolean")return e;if(typeof e=="number")return e!==0;if(typeof e=="string"){const n=e.trim().toLowerCase();return n==="1"||n==="true"||n==="yes"||n==="pit"}return!1},Ke=e=>Array.from(new Set(e.filter(l=>typeof l=="number"&&Number.isFinite(l)&&l>0))).sort((l,p)=>l-p).map(l=>({x:l,stroke:"rgba(255,255,255,0.7)",strokeWidth:1.2,strokeDasharray:"3 3",ifFront:!0,label:{position:"top",value:"PIT",fill:"#ffffff",fontSize:9,fontWeight:600,dy:2}})),Et=({lapData:e,comparisonDriver:n})=>{const l=e,p=n,r=j.useMemo(()=>{if(!l||l.length===0||!p)return[];const d=new Map;l.forEach(h=>{h!=null&&h.lap_number&&d.set(h.lap_number,h)});const _=Array.isArray(p==null?void 0:p.lap_times)?p.lap_times:[];if(_.length===0)return[];const m=new Map;_.forEach(h=>{const k=Dt(h);k&&m.set(k,h)});const y=Array.from(new Set([...d.keys(),...m.keys()])).sort((h,k)=>h-k);let w=0,g=0;return y.map(h=>{const k=d.get(h),c=m.get(h),$=Me(k==null?void 0:k.lap_time_ms),K=Me((c==null?void 0:c.lap_time_ms)??(c==null?void 0:c.lap_time_in_ms)??(c==null?void 0:c.lapTimeInMs));return $!==null&&(w+=$),K!==null&&(g+=K),{lap:h,targetLapSeconds:$!==null?$/1e3:null,comparisonLapSeconds:K!==null?K/1e3:null,targetLapMs:$,comparisonLapMs:K,targetCumulativeSeconds:w>0?w/1e3:null,comparisonCumulativeSeconds:g>0?g/1e3:null,deltaSeconds:$!==null&&K!==null?(w-g)/1e3:null}}).filter(h=>h.targetLapSeconds!==null||h.comparisonLapSeconds!==null)},[l,p]),v=j.useMemo(()=>r.filter(d=>d.deltaSeconds!==null).map(d=>({lap:d.lap,deltaSeconds:d.deltaSeconds})),[r]),{statusOverlays:b,statusLegend:x}=j.useMemo(()=>{var h;if(!l||l.length===0)return{statusOverlays:[],statusLegend:[]};const d=[],_=new Set,m=[...l].filter(k=>typeof k.lap_number=="number").sort((k,c)=>(k.lap_number||0)-(c.lap_number||0));let y=null,w=[],g=null;const T=k=>{y&&w.length>0&&g!==null&&d.push({startLap:g,endLap:k,statuses:w}),y=null,w=[],g=null};if(m.forEach((k,c)=>{var s;const $=k.lap_number||0,K=Kt(k);if(K.forEach(C=>_.add(C)),K.length===0){y!==null&&g!==null&&T($-1>=g?$-1:$);return}const I=K.join("|");y!==I&&(y!==null&&g!==null&&T(((s=m[c-1])==null?void 0:s.lap_number)||$),y=I,w=K,g=$)}),y&&w.length>0&&g!==null){const k=((h=m[m.length-1])==null?void 0:h.lap_number)||g;T(k)}return{statusOverlays:d,statusLegend:Array.from(_)}},[l]);return{lapComparisonData:r,deltaComparisonData:v,statusOverlays:b,statusLegend:x}},Kt=e=>{const n=new Set,l=(e.max_safety_car_status||"").toString().toUpperCase();return l==="SAFETY_CAR"?n.add("safetyCar"):l==="VIRTUAL_SAFETY_CAR"&&n.add("virtualSafetyCar"),(e.vehicle_fia_flags||"").toString().toUpperCase().includes("YELLOW")&&n.add("yellowFlag"),Ut(e)&&n.add("rain"),Array.from(n).sort()},Ut=e=>{var r,v,b,x,d,_;const n=[e.weather,e.trackWeather,(r=e.car_damage_data)==null?void 0:r.weather,(v=e.car_damage_data)==null?void 0:v.Weather,(b=e.tyre_sets_data)==null?void 0:b.weather,(x=e.tyre_sets_data)==null?void 0:x.Weather];for(const m of n)if(typeof m=="string"&&m.toLowerCase().includes("rain"))return!0;const l=(e.tire_compound||"").toString().toLowerCase();if(l.includes("intermediate")||l==="i"||l.includes("wet")||l==="w")return!0;const p=(((d=e.tyre_sets_data)==null?void 0:d.visual_compound)||((_=e.tyre_sets_data)==null?void 0:_.visualCompound)||"").toString().toLowerCase();return!!(p.includes("intermediate")||p.includes("wet"))},Ot=e=>{const n=j.useMemo(()=>!e||e.length===0?[]:[...e].filter(x=>x==null?void 0:x.lap_number).sort((x,d)=>(x.lap_number||0)-(d.lap_number||0)).map(x=>{const d=x.lap_time_ms&&x.lap_time_ms>0?x.lap_time_ms/1e3:null,_=x.tire_compound?ge(he(x.tire_compound)):void 0,m=he(x.tire_compound);return{lap:x.lap_number,lapTimeSeconds:d,tireCompound:_,tireColorHex:Ft(x.tire_compound),compoundKey:m}}),[e]),l=j.useMemo(()=>{if(!n||n.length===0)return[];const b=[];let x=n[0].tireCompound||"Unknown",d=n[0].tireColorHex,_=n[0].lap,m=n[0].lap;for(let y=1;y<n.length;y++){const w=n[y],g=w.tireCompound||"Unknown",T=w.tireColorHex;g!==x&&(b.push({startLap:_,endLap:m,compound:x,color:d}),x=g,d=T,_=w.lap),m=w.lap}return b.push({startLap:_,endLap:m,compound:x,color:d}),b},[n]),p=j.useMemo(()=>{const b=new Map;return l.forEach(x=>{const d=he(x.compound);b.set(x.startLap,{compoundKey:d,color:x.color,label:ge(d)})}),b},[l]),r=j.useMemo(()=>{if(!n||n.length===0)return{data:[],lines:[]};const b=[],x=new Set;n.forEach(m=>{const y=m.compoundKey||he(m.tireCompound);x.has(y)||(x.add(y),b.push({key:y,color:m.tireColorHex,label:ge(y)}))});const d=n.map(m=>{const y={lap:m.lap,tireCompound:m.tireCompound,tireColorHex:m.tireColorHex,compoundKey:m.compoundKey};return b.forEach(({key:w})=>{y[w]=null}),m.lapTimeSeconds!==null&&(y[m.compoundKey]=m.lapTimeSeconds),y}),_=b.map(({key:m,color:y,label:w})=>({dataKey:m,name:w,stroke:y,dot:!1,connectNulls:!1}));return{data:d,lines:_}},[n]),v=j.useMemo(()=>{if(!n||n.length===0)return[];const b=new Map;return n.forEach(x=>{if(x.lapTimeSeconds===null||x.lapTimeSeconds===void 0)return;const d=x.compoundKey||"UNK",_=b.get(d);_?(_.total+=x.lapTimeSeconds,_.count+=1):b.set(d,{total:x.lapTimeSeconds,count:1,color:x.tireColorHex})}),Array.from(b.entries()).map(([x,{total:d,count:_,color:m}])=>{const y=x==="UNK"?"Unknown":ge(x);return{compoundKey:x,compoundLabel:y,averageSeconds:_>0?d/_:0,color:m,lapCount:_}}).sort((x,d)=>x.averageSeconds-d.averageSeconds)},[n]);return{stintChartData:n,stintSegments:l,stintStartLapInfo:p,compoundLineSetup:r,compoundAverages:v}},Bt=({lapData:e,driver:n,sessionDrivers:l=[]})=>j.useMemo(()=>{var S;if(!e||e.length===0||!n)return null;const p=e.filter(f=>f.lap_time_ms&&f.lap_time_ms>0);if(p.length===0)return null;const r=p.map(f=>f.lap_time_ms),v=Math.min(...r),b=Math.max(...r);let x=null;if(l&&l.length>0){const f=l.find(o=>(o==null?void 0:o.fastestLap)===!0||(o==null?void 0:o.fastest_lap)===!0||(o==null?void 0:o.fastest_lap)===1||(o==null?void 0:o.fastest_lap)==="true");if(f){const o=f.fastestLapTime??f.raceBestLapTime??f.best_lap_time_ms??null;o!=null&&o>0&&(x=Number(o))}}const d=Math.round(r.reduce((f,o)=>f+o,0)/r.length),_=r.reduce((f,o)=>f+Math.pow(o-d,2),0)/r.length,y=(Math.sqrt(_)/d*100).toFixed(2),w=n._totalRaceTimeMs||r.reduce((f,o)=>f+o,0);let g=null;for(let f=e.length-1;f>=0;f--){const o=e[f];if(typeof o.gap_to_leader_ms=="number"&&Number.isFinite(o.gap_to_leader_ms)&&o.gap_to_leader_ms>0){g=o.gap_to_leader_ms;break}}if(g===null){const f=n.raceGap;typeof f=="number"&&Number.isFinite(f)&&f>0&&(g=f)}const T=p.filter(f=>f.pit_stop).length,h=[...new Set(p.map(f=>f.tire_compound).filter(Boolean))],k=n.gridPosition||n.position||null,c=n.racePosition||n.position||null,$=k&&c?k-c:null,K=Math.min(...p.map(f=>f.sector1_ms||1/0).filter(f=>f!==1/0)),I=Math.min(...p.map(f=>f.sector2_ms||1/0).filter(f=>f!==1/0)),s=Math.min(...p.map(f=>f.sector3_ms||1/0).filter(f=>f!==1/0)),C=p.filter(f=>f.max_safety_car_status==="SAFETY_CAR").length,A=p.filter(f=>f.max_safety_car_status==="VIRTUAL_SAFETY_CAR").length,E=p.filter(f=>f.vehicle_fia_flags&&f.vehicle_fia_flags!=="None"&&(f.vehicle_fia_flags.includes("YELLOW")||f.vehicle_fia_flags.includes("YELLOW_FLAG"))).length;return{fastestLap:v,sessionFastestLap:x,slowestLap:b,avgLap:d,consistencyPercent:y,totalTime:w,gapToLeaderMs:g,pitStops:T,tireCompounds:h,gridPosition:k,finishPosition:c,positionsGained:$,bestSector1:K!==1/0?K:void 0,bestSector2:I!==1/0?I:void 0,bestSector3:s!==1/0?s:void 0,scLaps:C,vscLaps:A,yellowFlags:E,totalLaps:p.length,fastestLapNumber:((S=p.find(f=>f.lap_time_ms===v))==null?void 0:S.lap_number)||null}},[e,n,l]),ne="rounded-3xl border border-slate-200 bg-white shadow-md dark:border-slate-800 dark:bg-slate-950/70 p-6",re="text-base font-semibold text-slate-900 dark:text-slate-100",W="text-sm text-slate-500 dark:text-slate-400",R="text-base font-bold text-slate-900 dark:text-slate-100",Gt=({raceStats:e,sessionLabel:n,sessionKind:l,formatGapTime:p,formatSectorTime:r,getTireCompoundColor:v})=>e?t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsxs("div",{className:ne,children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[t.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-2xl bg-blue-500/15 text-blue-500",children:t.jsx(Ee,{className:"h-5 w-5"})}),t.jsxs("h3",{className:re,children:[n," Pace"]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:W,children:"Fastest Lap"}),t.jsx("span",{className:R,children:G.formatTimeFromMs(e.fastestLap)})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:W,children:"Avg Lap"}),t.jsx("span",{className:R,children:e.avgLap>0?G.formatTimeFromMs(e.avgLap):"--:--.---"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:W,children:"Consistency"}),t.jsxs("span",{className:R,children:[e.consistencyPercent,"%"]})]})]})]}),t.jsxs("div",{className:ne,children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[t.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-2xl bg-emerald-500/15 text-emerald-500",children:t.jsx(nt,{className:"h-5 w-5"})}),t.jsxs("h3",{className:re,children:[n," Summary"]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:W,children:"Total Time"}),t.jsx("span",{className:R,children:G.formatTimeFromMs(e.totalTime)})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:W,children:"Gap to Leader"}),t.jsx("span",{className:R,children:e.gapToLeaderMs!==null&&e.gapToLeaderMs!==void 0&&e.gapToLeaderMs>0?p(e.gapToLeaderMs):"Leader"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:W,children:"Total Laps"}),t.jsx("span",{className:R,children:e.totalLaps})]})]})]}),t.jsxs("div",{className:ne,children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[t.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-2xl bg-purple-500/15 text-purple-500",children:t.jsx(ut,{className:"h-5 w-5"})}),t.jsx("h3",{className:re,children:"Session Strategy"})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:W,children:"Pit Stops"}),t.jsx("span",{className:R,children:e.pitStops})]}),t.jsxs("div",{children:[t.jsx("span",{className:`${W} block mb-2`,children:"Compounds Used"}),t.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.tireCompounds.length>0?e.tireCompounds.map((b,x)=>t.jsx("div",{className:"flex items-center gap-2 rounded-full border border-slate-200 bg-slate-50 px-3 py-1 text-sm font-medium text-slate-700 dark:border-slate-700 dark:bg-slate-900/70 dark:text-slate-200",children:(()=>{const d=G.getTireCompoundIcon(b),_=G.getTireCompoundText(b);return d?t.jsx("img",{src:d,alt:`${_} tire`,className:"h-5 w-5"}):t.jsx("span",{className:v(b),children:_})})()},`${b??"unknown"}-${x}`)):t.jsx("span",{className:"text-sm text-slate-500 dark:text-slate-400",children:"--"})})]})]})]}),t.jsxs("div",{className:ne,children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[t.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-2xl bg-amber-500/15 text-amber-500",children:t.jsx(rt,{className:"h-5 w-5"})}),t.jsxs("h3",{className:re,children:[n," Positions"]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:W,children:"Grid"}),t.jsx("span",{className:R,children:l==="practice"?"--":`P${e.gridPosition!=null?e.gridPosition:"--"}`})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:W,children:"Finish"}),t.jsx("span",{className:R,children:l==="practice"?"--":`P${e.finishPosition!=null?e.finishPosition:"--"}`})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:W,children:"Change"}),t.jsx("span",{className:`${R} ${l==="practice"?"text-slate-400 dark:text-slate-500":e.positionsGained!==null?e.positionsGained>0?"text-emerald-500":e.positionsGained<0?"text-rose-500":"text-slate-500 dark:text-slate-400":"text-slate-500 dark:text-slate-400"}`,children:l==="practice"?"--":e.positionsGained!==null?e.positionsGained>0?`+${e.positionsGained}`:e.positionsGained<0?`${e.positionsGained}`:"0":"--"})]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:ne,children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[t.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-2xl bg-indigo-500/15 text-indigo-500",children:t.jsx(yt,{className:"h-5 w-5"})}),t.jsx("h3",{className:re,children:"Best Sectors"})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`${W} mb-1`,children:"Sector 1"}),t.jsx("div",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:e.bestSector1!==void 0&&e.bestSector1!==null?r(e.bestSector1):"--.---"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`${W} mb-1`,children:"Sector 2"}),t.jsx("div",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:e.bestSector2!==void 0&&e.bestSector2!==null?r(e.bestSector2):"--.---"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`${W} mb-1`,children:"Sector 3"}),t.jsx("div",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:e.bestSector3!==void 0&&e.bestSector3!==null?r(e.bestSector3):"--.---"})]})]}),e.fastestLapNumber&&t.jsx("div",{className:"mt-4 border-t border-slate-200 pt-3 text-center dark:border-slate-800",children:t.jsxs("span",{className:W,children:["Fastest Lap: Lap ",e.fastestLapNumber]})})]}),t.jsxs("div",{className:ne,children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[t.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-2xl bg-amber-500/15 text-amber-500",children:t.jsx(it,{className:"h-5 w-5"})}),t.jsx("h3",{className:re,children:"Track Status"})]}),t.jsxs("div",{className:"space-y-3",children:[e.scLaps>0&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:W,children:"Safety Car Laps"}),t.jsx("span",{className:"rounded-full bg-amber-100 px-3 py-1 text-xs font-semibold text-amber-700 dark:bg-amber-400/15 dark:text-amber-200",children:e.scLaps})]}),e.vscLaps>0&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:W,children:"Virtual Safety Car"}),t.jsx("span",{className:"rounded-full bg-amber-100 px-3 py-1 text-xs font-semibold text-amber-700 dark:bg-amber-400/15 dark:text-amber-200",children:e.vscLaps})]}),e.yellowFlags>0&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:W,children:"Yellow Flags"}),t.jsx("span",{className:"rounded-full bg-amber-100 px-3 py-1 text-xs font-semibold text-amber-700 dark:bg-amber-400/15 dark:text-amber-200",children:e.yellowFlags})]}),e.scLaps===0&&e.vscLaps===0&&e.yellowFlags===0&&t.jsx("div",{className:"text-center py-2",children:t.jsx("span",{className:W,children:"Clean race – no incidents"})})]})]})]})]}):t.jsx("div",{className:"text-center py-12 text-slate-500 dark:text-slate-400",children:"No race statistics available"}),ie=({title:e,description:n,headerSlot:l,children:p,className:r,bodyClassName:v="px-6 py-4"})=>t.jsxs("div",{className:ot("rounded-3xl border border-slate-200 bg-white shadow-md dark:border-slate-800 dark:bg-slate-950/70",r),children:[t.jsxs("div",{className:"flex flex-col gap-4 border-b border-slate-200 px-6 py-5 dark:border-slate-800 sm:flex-row sm:items-center sm:justify-between",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:e}),n&&t.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:n})]}),l&&t.jsx("div",{className:"sm:text-right",children:l})]}),t.jsx("div",{className:v,children:p})]}),Wt=({driverName:e,comparisonDriverName:n,comparisonDriverId:l,onSelectComparisonDriver:p,comparisonOptions:r,lapComparisonData:v,deltaComparisonData:b,overlayLegendItems:x,chartOverlays:d,formatSecondsValue:_,formatSecondsDifference:m,LapTimeTooltipContent:y,DeltaTooltipContent:w,hexToRgba:g,pitReferenceLines:T=[]})=>t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Driver Comparison"}),t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Comparing lap pace for ",e,n?` vs ${n}`:"","."]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("label",{htmlFor:"comparison-driver",className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Compare against"}),t.jsx("select",{id:"comparison-driver",className:"rounded-xl border border-slate-200 bg-white px-3 py-1.5 text-sm font-medium text-slate-700 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-400/40",value:l??"",onChange:h=>p(h.target.value||null),children:r.length===0?t.jsx("option",{value:"",children:"No other drivers available"}):r.map(h=>t.jsx("option",{value:h.id,children:h.position?`P${h.position} - ${h.name}`:h.name},h.id))})]})]}),t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[t.jsx(ie,{title:"Lap Time Comparison",description:"Lap times in seconds — lower values indicate a faster lap.",bodyClassName:"px-6 py-4",children:t.jsxs("div",{className:"relative h-80 w-full",children:[x.length>0&&t.jsx("div",{className:"absolute right-3 top-3 z-10 flex flex-wrap gap-2 rounded-md bg-white/80 px-3 py-2 text-xs text-gray-600 backdrop-blur dark:bg-gray-900/70 dark:text-gray-200",children:x.map(h=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"h-2.5 w-2.5 rounded-sm",style:{backgroundColor:h.pattern?void 0:h.color,backgroundImage:h.pattern==="rain"?`repeating-linear-gradient(45deg, ${g(h.color,.45)} 0, ${g(h.color,.45)} 4px, ${g(h.color,.18)} 4px, ${g(h.color,.18)} 8px)`:h.pattern==="vsc"?`repeating-linear-gradient(0deg, ${g(h.color,.6)} 0, ${g(h.color,.6)} 2px, ${g(h.color,.2)} 2px, ${g(h.color,.2)} 5px)`:void 0}}),t.jsx("span",{children:h.label})]},h.status))}),l&&v.length>0&&v.some(h=>h.comparisonLapSeconds!==null)?t.jsx(pe,{data:v,lines:[{dataKey:"targetLapSeconds",name:e||"Driver",stroke:P.info,dot:!1},{dataKey:"comparisonLapSeconds",name:n||"Comparison",stroke:P.danger,dot:!1}],autoDomainPadding:{axis:"y",padding:10,clampToZero:!1},yTickFormatter:h=>_(h),tooltipContent:t.jsx(y,{}),legend:!0,overlays:d,className:"h-full",enableSeriesHighlight:!0,dimmedOpacity:1,referenceLines:T}):t.jsx("div",{className:"flex h-full items-center justify-center text-sm text-gray-500 dark:text-gray-400",children:r.length===0?"Comparison data is not available for this session.":"Comparison driver has no lap time data available."})]})}),t.jsx(ie,{title:"Cumulative Time Delta",description:`Positive values indicate ${e||"the selected driver"} is behind the comparison driver.`,bodyClassName:"px-6 py-4",children:t.jsxs("div",{className:"relative h-72 w-full",children:[x.length>0&&t.jsx("div",{className:"absolute right-3 top-3 z-10 flex flex-wrap gap-2 rounded-md bg-white/80 px-3 py-2 text-xs text-gray-600 backdrop-blur dark:bg-gray-900/70 dark:text-gray-200",children:x.map(h=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"h-2.5 w-2.5 rounded-sm",style:{backgroundColor:h.color}}),t.jsx("span",{children:h.label})]},`delta-${h.status}`))}),l&&b.length>0?t.jsx(pe,{data:b,lines:[{dataKey:"deltaSeconds",name:"Δ time vs comparison",stroke:P.amber,dot:!1}],yTickFormatter:h=>m(h),tooltipContent:t.jsx(w,{}),referenceLines:[{y:0,stroke:_e.muted,strokeDasharray:"4 4"},...T],overlays:d,className:"h-full",enableSeriesHighlight:!0,dimmedOpacity:1}):t.jsx("div",{className:"flex h-full items-center justify-center text-sm text-gray-500 dark:text-gray-400",children:"Additional comparison data is not available for this driver pairing."})]})})]})]}),$e={fill:_e.mutedStrong,fontSize:12};function zt({data:e,bars:n,xKey:l="name",xAxisProps:p,yAxisProps:r,xTickFormatter:v,yTickFormatter:b,tooltipContent:x,tooltipProps:d,legend:_,referenceLines:m,cartesianGrid:y=!0,cartesianGridProps:w,margin:g,className:T,height:h="100%",ariaLabel:k}){const[c,$]=Q.useState(null),K=Q.useMemo(()=>({top:16,right:24,bottom:16,left:0,...g}),[g]),I=Q.useCallback(()=>{$(null)},[]),s=Q.useCallback(o=>{const{barKey:M,barIndex:U}=o.currentTarget.dataset;!M||U===void 0||$({key:M,index:Number(U)})},[]),C=Q.useCallback(o=>{const{barKey:M,barIndex:U}=o.currentTarget.dataset;if(!M||U===void 0){$(null);return}const B=Number(U);$(H=>(H==null?void 0:H.key)===M&&H.index===B?null:H)},[]),A=Q.useCallback(o=>{var U;if(typeof x=="function")return x(o);if(x!==void 0)return x;if(!o.active||!((U=o.payload)!=null&&U.length))return null;const M=o.payload[0];return t.jsxs("div",{className:"rounded-md border border-gray-200 bg-white px-3 py-2 text-xs text-gray-700 shadow-lg dark:border-gray-700 dark:bg-gray-900 dark:text-gray-200",children:[o.label!==void 0&&t.jsx("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:o.label}),t.jsx("div",{className:"mt-1",children:M.value})]})},[x]),E=Q.useMemo(()=>({pointerEvents:"none",...d==null?void 0:d.wrapperStyle}),[d==null?void 0:d.wrapperStyle]),S=Q.useCallback((o,M)=>{const U=v??(p==null?void 0:p.tickFormatter),B=U?U(o,M):o;return typeof B=="string"?B:typeof B=="number"?B.toString():typeof o=="string"?o:typeof o=="number"?o.toString():""},[p==null?void 0:p.tickFormatter,v]),f=Q.useCallback((o,M)=>{const U=b??(r==null?void 0:r.tickFormatter),B=U?U(o,M):o;return typeof B=="string"?B:typeof B=="number"?B.toString():typeof o=="string"?o:typeof o=="number"?o.toString():""},[r==null?void 0:r.tickFormatter,b]);return t.jsx("div",{className:T,role:"img","aria-label":k,style:{width:"100%",height:h},children:t.jsx(xt,{width:"100%",height:"100%",children:t.jsxs(kt,{data:e,margin:K,onMouseLeave:I,children:[y&&t.jsx(ft,{strokeDasharray:"3 3",strokeOpacity:.15,...w}),t.jsx(Fe,{dataKey:l,tick:{...$e,...p==null?void 0:p.tick},tickLine:!1,...p,tickFormatter:S}),t.jsx(Ae,{tick:{...$e,...r==null?void 0:r.tick},tickLine:!1,width:(r==null?void 0:r.width)??80,...r,tickFormatter:f}),t.jsx(ht,{...d,cursor:!1,content:A,wrapperStyle:E}),_&&t.jsx(gt,{}),m==null?void 0:m.map((o,M)=>t.jsx(bt,{...o},`bar-ref-line-${M}`)),n.map(o=>t.jsx(De,{dataKey:o.dataKey,name:o.name,fill:o.fill,radius:o.radius??4,barSize:o.barSize,stackId:o.stackId,isAnimationActive:o.isAnimationActive??!1,label:o.label,children:e.map((M,U)=>{const B=o.getFill?o.getFill(M,U):o.fill,H=(c==null?void 0:c.key)===o.dataKey&&c.index===U,J=c?H?1:.35:.85;return t.jsx(_t,{"data-bar-key":o.dataKey,"data-bar-index":U,fill:B,style:{cursor:"pointer",opacity:J,transition:"opacity 150ms ease"},onMouseEnter:s,onMouseLeave:C},`cell-${o.dataKey}-${U}`)})},o.dataKey))]})})})}const Ht=({averageLapSeconds:e,compoundLineSetup:n,stintLines:l,stintSegments:p,compoundAverages:r,formatSecondsValue:v,StintLapTooltip:b,CompoundBarTooltip:x,pitReferenceLines:d=[]})=>{const _=j.useMemo(()=>{const m=d??[];return e===null?m:[...m,{y:e,stroke:P.neutral,strokeDasharray:"4 4",label:{value:"Avg",fill:_e.mutedStrong,position:"right"}}]},[e,d]);return t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[t.jsx(ie,{title:"Lap Pace by Tire Stint",description:"Colored bands indicate tire stints. Dots show lap times for each stint start.",headerSlot:e!==null?t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400",children:"Average Lap"}),t.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:v(e)})]}):null,bodyClassName:"px-6 py-4",children:t.jsx("div",{className:"h-96 w-full",children:n.data.length>0?t.jsx(pe,{data:n.data,lines:l,autoDomainPadding:{axis:"y",padding:10,clampToZero:!1},yTickFormatter:m=>v(m),tooltipContent:t.jsx(b,{}),referenceLines:_,referenceAreas:p.map(m=>({x1:m.startLap-.5,x2:m.endLap+.5,fill:m.color,fillOpacity:.08,strokeOpacity:0})),className:"h-full"}):t.jsx("div",{className:"flex h-full items-center justify-center text-sm text-gray-500 dark:text-gray-400",children:"Lap data not available to display stints."})})}),t.jsx(ie,{title:"Average Lap by Tire Compound",description:"Average lap time recorded on each tire compound.",bodyClassName:"px-6 py-4",children:t.jsx("div",{className:"h-96 w-full",children:r.length>0?t.jsx(zt,{data:r,bars:[{dataKey:"averageSeconds",name:"Average Lap",fill:P.info,barSize:32,getFill:m=>m.color}],xKey:"compoundLabel",xAxisProps:{dataKey:"compoundLabel"},yTickFormatter:m=>v(m),tooltipContent:m=>t.jsx(x,{...m}),legend:!1,className:"h-full"}):t.jsx("div",{className:"flex h-full items-center justify-center text-sm text-gray-500 dark:text-gray-400",children:"No average lap data available for tire compounds."})})})]})})},Yt=({driverName:e,lapData:n,sessionDrivers:l,formatSecondsValue:p,getTeamColorHex:r,pitLaps:v,primaryDriverId:b=null})=>{const[x,d]=j.useState(null),_=j.useMemo(()=>new Set(v),[v]),m=j.useMemo(()=>n.map(s=>({lap:s.lap_number,lapSeconds:s.lap_time_ms!=null?s.lap_time_ms/1e3:null,sector1Seconds:s.sector1_ms!=null?s.sector1_ms/1e3:null,sector2Seconds:s.sector2_ms!=null?s.sector2_ms/1e3:null,sector3Seconds:s.sector3_ms!=null?s.sector3_ms/1e3:null,pitStop:typeof s.lap_number=="number"&&_.has(s.lap_number)})),[n,_]),y=j.useMemo(()=>[{dataKey:"lapSeconds",name:"Lap",stroke:"#f97316"},{dataKey:"sector1Seconds",name:"Sector 1",stroke:"#3b82f6"},{dataKey:"sector2Seconds",name:"Sector 2",stroke:"#10b981"},{dataKey:"sector3Seconds",name:"Sector 3",stroke:"#a855f7"}],[]),w=j.useMemo(()=>e?e.trim().toLowerCase():null,[e]),g=j.useMemo(()=>l.map((s,C)=>{var J,oe,ue,xe,le;const A=(s==null?void 0:s.id)??(s==null?void 0:s.driver_id)??(s==null?void 0:s.driverId)??(s==null?void 0:s.member_id)??(s==null?void 0:s.driverNumber),E=String(A??(s==null?void 0:s.name)??`driver-${C}`),S=(s==null?void 0:s.name)??(s==null?void 0:s.driverName)??(s==null?void 0:s.json_driver_name)??(s==null?void 0:s.mapping_driver_name)??((oe=(J=s==null?void 0:s.additional_data)==null?void 0:J.participantData)==null?void 0:oe.name)??`Driver ${C+1}`,f=(s==null?void 0:s.team)??(s==null?void 0:s.json_team_name)??((xe=(ue=s==null?void 0:s.additional_data)==null?void 0:ue.participantData)==null?void 0:xe.team)??((le=s==null?void 0:s.additional_data)==null?void 0:le.teamName)??"",o=r(f)||"#94a3b8",M=Array.isArray(s==null?void 0:s.lap_times)?s.lap_times:[],U=S?String(S).trim().toLowerCase():null,B=b!=null?String(b):null,H=B!=null&&B===String(A??E)||w!=null&&U===w;return{id:E,rawId:A??E,name:S,stroke:o,laps:M,strokeWidth:H?3:1.5,strokeOpacity:H?1:.35}}),[l,r,b,w]),T=j.useMemo(()=>{const s=n.reduce((A,E)=>Math.max(A,(E==null?void 0:E.lap_number)??0),0),C=g.reduce((A,E)=>{const f=(Array.isArray(E.laps)?E.laps:[]).reduce((o,M)=>Math.max(o,Number((M==null?void 0:M.lap_number)??(M==null?void 0:M.lapNumber)??0)),0);return Math.max(A,f)},0);return Math.max(s,C)},[g,n]),h=j.useMemo(()=>{if(!T||T<=0)return[];const s=[];for(let C=1;C<=T;C+=1){const A={lap:C};g.forEach(E=>{const S=E.laps.find(o=>((o==null?void 0:o.lap_number)??(o==null?void 0:o.lapNumber))===C),f=(S==null?void 0:S.track_position)??(S==null?void 0:S.trackPosition)??(S==null?void 0:S.position)??(S==null?void 0:S.racePosition)??null;A[E.id]=f!=null&&!Number.isNaN(Number(f))?Number(f):null}),s.push(A)}return s},[g,T]),k=j.useMemo(()=>g.map(s=>({dataKey:s.id,name:s.name,stroke:s.stroke||"#94a3b8",strokeWidth:s.strokeWidth??2,strokeOpacity:s.strokeOpacity??1,dot:!1,activeDot:s.strokeOpacity===1?{r:4}:!1})),[g]),c=j.useMemo(()=>{var s;return((s=g.find(C=>C.strokeOpacity===1))==null?void 0:s.id)??null},[g]),$=j.useMemo(()=>Ke(v),[v]),K=j.useCallback(({active:s,payload:C,label:A})=>{if(!s||!C||C.length===0)return null;const E=C.filter(S=>(S==null?void 0:S.value)!=null);return E.length===0?null:t.jsxs("div",{className:"rounded-lg border border-white/20 bg-white/90 px-3 py-2 text-xs text-slate-800 shadow-lg backdrop-blur dark:border-white/10 dark:bg-slate-900/80 dark:text-slate-200",children:[t.jsxs("div",{className:"font-semibold text-slate-900 dark:text-white",children:["Lap ",A]}),t.jsx("div",{className:"mt-1 space-y-1",children:E.map(S=>t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:S.name}),t.jsx("span",{className:"font-semibold text-slate-900 dark:text-white",children:p(typeof S.value=="number"?S.value:null)})]},S.dataKey))})]})},[p]),I=j.useCallback(({active:s,payload:C,label:A})=>{if(!s||!C||C.length===0)return null;const E=x&&C.find(M=>M.dataKey===x)||c&&C.find(M=>M.dataKey===c)||C.find(M=>M.value!=null)||C[0];if(!E||c&&E.dataKey!==c)return null;const S=g.find(M=>M.id===E.dataKey),f=(S==null?void 0:S.name)??String(E.dataKey),o=E.value!=null?`P${E.value}`:"No data";return t.jsxs("div",{className:"rounded-lg border border-white/20 bg-white/90 px-3 py-2 text-xs text-slate-800 shadow-lg backdrop-blur dark:border-white/10 dark:bg-slate-900/80 dark:text-slate-200",children:[t.jsx("div",{className:"font-semibold text-slate-900 dark:text-white",children:f}),t.jsxs("div",{className:"text-slate-600 dark:text-slate-300",children:["Lap ",A,": ",o]})]})},[g,x,c]);return t.jsxs("div",{className:"space-y-6",children:[t.jsx(ie,{title:"Pace by Lap",description:`${e}'s lap and sector pace across the session.`,children:t.jsx("div",{className:"h-80",children:t.jsx(pe,{data:m,lines:y,tooltipContent:K,yTickFormatter:s=>p(typeof s=="number"?s:null),referenceLines:$,legend:!0,enableSeriesHighlight:!0,dimmedOpacity:1})})}),t.jsx(ie,{title:"Position by Lap",description:"Track position trends for every driver in the session.",children:t.jsx("div",{className:"h-96",children:t.jsx(pe,{data:h,lines:k,tooltipContent:I,yAxisProps:{type:"number",allowDecimals:!1,domain:["dataMin","dataMax"],reversed:!0,tickFormatter:s=>`P${s}`},referenceLines:$,legend:!1,enableSeriesHighlight:!0,dimmedOpacity:1,onSeriesHoverStart:d,onSeriesHoverEnd:()=>d(null)})})})]})},Rt=({driverId:e,raceId:n,initialSessionType:l})=>{var Ce,Le;const{raceData:p,sessions:r,defaultSessionId:v,loading:b,error:x}=wt(e,n),[d,_]=lt(),m=d.get("tab"),[y,w]=j.useState(null),g=j.useRef(!1),[T,h]=j.useState(m&&["overview","pace","comparison","strategy"].includes(m)?m:"overview"),[k,c]=j.useState(null),$=j.useCallback(a=>{h(a),_(i=>{const u=new URLSearchParams(i);return u.set("tab",a),u})},[_]);j.useEffect(()=>{m&&["overview","pace","comparison","strategy"].includes(m)&&h(m)},[m]);const K=j.useCallback(a=>a===10?"race":a>=5&&a<=9?"qualifying":"practice",[]);j.useEffect(()=>{var N;if(r.length===0)return;const a=new Set(r.map(L=>L.sessionId));if(y?a.has(y):!1)return;let u=null;if(!g.current&&l){const L=r.find(O=>K(O.sessionType)===l);L!=null&&L.sessionId&&(u=L.sessionId,g.current=!0)}!u&&v&&a.has(v)&&(u=v),u||(u=((N=r[0])==null?void 0:N.sessionId)??null),u&&u!==y&&w(u)},[r,y,l,v,K]);const I=j.useMemo(()=>r.find(a=>a.sessionId===y)||null,[r,y]),s=(I==null?void 0:I.driver)??null,C=(I==null?void 0:I.lapData)??[],A=(I==null?void 0:I.sessionDrivers)??[],E=(I==null?void 0:I.sessionName)||(I==null?void 0:I.sessionTypeName)||"Session",S=I?K(I.sessionType):null,f=a=>G.getTeamColorHex(a??""),o=a=>G.getTireCompoundColor(a),M=j.useMemo(()=>C.filter(a=>At((a==null?void 0:a.pit_stop)??(a==null?void 0:a.pitStop)??(a==null?void 0:a.pit)??(a==null?void 0:a.isPitStop))).map(a=>a.lap_number).filter(a=>typeof a=="number"&&Number.isFinite(a)&&a>0),[C]),U=j.useMemo(()=>Ke(M),[M]),B=a=>{var u,N,L,O,D,z,Y,V;const i=[a==null?void 0:a.mappedUserName,a==null?void 0:a.mapped_user_name,a==null?void 0:a.mappedDriverName,a==null?void 0:a.mapped_driver_name,a==null?void 0:a.driver_name,a==null?void 0:a.json_driver_name,a==null?void 0:a.mapping_driver_name,a==null?void 0:a.name,(N=(u=a==null?void 0:a.additional_data)==null?void 0:u.participantData)==null?void 0:N.name,(O=(L=a==null?void 0:a.additionalData)==null?void 0:L.participantData)==null?void 0:O.name,(z=(D=a==null?void 0:a.additional_data)==null?void 0:D.participantData)==null?void 0:z.driverName,(V=(Y=a==null?void 0:a.additionalData)==null?void 0:Y.participantData)==null?void 0:V.driverName];for(const Z of i)if(typeof Z=="string"){const ae=Z.trim();if(ae.length>0)return ae}return"Unknown Driver"},H=j.useMemo(()=>!A||A.length===0?[]:A.filter(i=>i&&i.id&&i.id!==(s==null?void 0:s.id)).sort((i,u)=>Number((i==null?void 0:i.position)??999)-Number((u==null?void 0:u.position)??999)).map(i=>({id:i.id,name:B(i),position:(i==null?void 0:i.position)!=null?Number(i.position):null})),[A,s]),J=j.useMemo(()=>k&&A.find(a=>a&&a.id===k)||null,[A,k]),oe=j.useMemo(()=>J?B(J):null,[J]);j.useEffect(()=>{var O;if(!s||A.length===0){k!==null&&c(null);return}const a=A.filter(D=>D&&D.id&&D.id!==s.id);if(a.length===0){k!==null&&c(null);return}if(k?a.some(D=>D.id===k):!1)return;const u=[...a].sort((D,z)=>Number((D==null?void 0:D.position)??999)-Number((z==null?void 0:z.position)??999)),N=u.find(D=>Number((D==null?void 0:D.position)??999)===1&&(D==null?void 0:D.id)),L=N!=null&&N.id&&N.id!==s.id?N.id:((O=u[0])==null?void 0:O.id)??null;c(L??null)},[s,A,y,k]);const{lapComparisonData:ue,deltaComparisonData:xe,statusOverlays:le,statusLegend:Ne}=Et({lapData:C,comparisonDriver:J}),{stintSegments:Ue,stintStartLapInfo:je,compoundLineSetup:be,compoundAverages:Oe}=Ot(C),F=Bt({lapData:C,driver:s,sessionDrivers:A}),ke=j.useCallback(a=>i=>{const{cx:u,cy:N,payload:L}=i,O=L==null?void 0:L.lap,D=O!=null?je.get(O):void 0;if(!D||D.compoundKey!==a)return t.jsx("g",{},`stint-dot-placeholder-${a}-${O??"na"}`);const z=typeof u=="number"?u:0,Y=typeof N=="number"?N:0,V=D.label?D.label.charAt(0).toUpperCase():a.charAt(0),Z=G.getTireCompoundIcon((L==null?void 0:L.tireCompound)||D.label||D.compoundKey)||G.getTireCompoundIcon(V)||null,ae=20,Se=ae/2;return Z?t.jsx("g",{pointerEvents:"none",children:t.jsx("image",{href:Z,x:z-Se,y:Y-Se,width:ae,height:ae,preserveAspectRatio:"xMidYMid meet"})},`stint-dot-icon-${a}-${O??"na"}`):t.jsx("text",{x:z,y:Y,textAnchor:"middle",dominantBaseline:"middle",alignmentBaseline:"middle",fontSize:12,fontWeight:700,fill:G.getTireCompoundColor(D.compoundKey),children:V},`stint-dot-text-${a}-${O??"na"}`)},[je]),Be=j.useMemo(()=>be.lines.map(a=>({...a,dot:ke(a.dataKey),connectNulls:!0})),[be.lines,ke]),ce=a=>a==null?"--:--.---":G.formatTimeFromMs(Math.round(a*1e3)),ve=a=>{if(a==null)return"--:--.---";const i=a>0?"+":a<0?"-":"",u=Math.abs(a);return u>=60?`${i}${G.formatTimeFromMs(Math.round(u*1e3))}`:`${i}${u.toFixed(3)}s`},Ge=({active:a,payload:i,label:u})=>!a||!i||i.length===0?null:t.jsxs("div",{className:"rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 text-xs shadow-lg",children:[t.jsxs("div",{className:"mb-1 font-semibold text-gray-900 dark:text-gray-100",children:["Lap ",u]}),i.map(N=>{if(!N)return null;const L=N.dataKey==="targetLapSeconds"?"targetLapMs":N.dataKey==="comparisonLapSeconds"?"comparisonLapMs":null,O=L?N.payload[L]:null,D=O!=null?G.formatTimeFromMs(Math.round(O)):N.value!==null&&N.value!==void 0?`${N.value.toFixed(3)}s`:"--:--.---";return t.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-200",children:[t.jsx("span",{className:"inline-flex h-2.5 w-2.5 rounded-full",style:{backgroundColor:N.color||P.info}}),t.jsxs("span",{children:[N.name,": ",D]})]},String(N.dataKey))})]}),We=({active:a,payload:i,label:u})=>{if(!a||!i||i.length===0)return null;const N=i[0];if(!N||N.value===void 0||N.value===null)return null;const L=ve(N.value);return t.jsxs("div",{className:"rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 text-xs shadow-lg",children:[t.jsxs("div",{className:"mb-1 font-semibold text-gray-900 dark:text-gray-100",children:["Lap ",u]}),t.jsxs("div",{className:"text-gray-700 dark:text-gray-200",children:[(s==null?void 0:s.name)||"Driver"," vs ",oe||"Comparison"]}),t.jsxs("div",{className:"mt-1 font-medium text-gray-900 dark:text-gray-100",children:["Δ ",L]})]})},ze=({active:a,payload:i,label:u})=>{var z;if(!a||!i||i.length===0)return null;const N=i[0];if(!N)return null;const L=N.value,O=((z=N.payload)==null?void 0:z.tireCompound)||"Unknown",D=L!=null?ce(L):"--:--.---";return t.jsxs("div",{className:"rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 text-xs shadow-lg",children:[t.jsxs("div",{className:"mb-1 font-semibold text-gray-900 dark:text-gray-100",children:["Lap ",u]}),t.jsxs("div",{className:"text-gray-700 dark:text-gray-200",children:["Lap Time: ",D]}),t.jsxs("div",{className:"text-gray-700 dark:text-gray-200",children:["Compound: ",O]})]})},He=({active:a,payload:i})=>{var Y,V,Z;if(!a||!i||i.length===0)return null;const u=i[0];if(!u)return null;const N=((Y=u.payload)==null?void 0:Y.compoundLabel)||"Unknown",L=((V=u.payload)==null?void 0:V.lapCount)||null,O=u.value,D=O!==null?ce(O):"--:--.---",z=(Z=u.payload)==null?void 0:Z.color;return t.jsxs("div",{className:"rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 text-xs shadow-lg",children:[t.jsx("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:N}),t.jsxs("div",{className:"mt-1 flex items-center gap-2 text-gray-700 dark:text-gray-200",children:[z&&t.jsx("span",{className:"inline-flex h-2.5 w-2.5 rounded-full",style:{backgroundColor:z}}),t.jsxs("span",{children:["Average Lap: ",D]})]}),L!==null&&t.jsxs("div",{className:"mt-1 text-gray-600 dark:text-gray-300",children:["Stint: ",L]})]})},Ye=j.useMemo(()=>F!=null&&F.avgLap&&F.avgLap>0?F.avgLap/1e3:null,[F]),Pe=j.useMemo(()=>le.map((a,i)=>({key:`overlay-${a.startLap}-${a.endLap}-${i}`,x1:a.startLap-.5,x2:a.endLap+.5,statuses:a.statuses})),[le]),Ve=j.useMemo(()=>Ne.map(a=>{var i,u;return{status:a,label:a==="safetyCar"?"Safety Car":a==="virtualSafetyCar"?"Virtual Safety Car":a==="yellowFlag"?"Yellow Flag":"Rain",color:((i=Te[a])==null?void 0:i.color)??P.neutral,pattern:(u=Te[a])==null?void 0:u.pattern}}),[Ne]),qe=(a,i)=>{if(!a)return`rgba(156, 163, 175, ${i})`;const u=a.trim();if(u.startsWith("rgba"))return u.replace(/rgba\(([^)]+)\)/,(Y,V)=>{const Z=V.split(",").map(ae=>ae.trim());return Z[3]=i.toString(),`rgba(${Z.join(", ")})`});if(u.startsWith("rgb"))return u.replace(/rgb\(([^)]+)\)/,(Y,V)=>`rgba(${V}, ${i})`);let N=u.replace("#","");N.length===3&&(N=N.split("").map(Y=>Y+Y).join(""));const L=parseInt(N,16),O=L>>16&255,D=L>>8&255,z=L&255;return`rgba(${O}, ${D}, ${z}, ${i})`},de=a=>a==null?"--.---":G.formatGapTimeFromMs(a),me=a=>a==null?"--.---":G.formatSectorTimeFromMs(a),we=j.useMemo(()=>{const a=new Map;if(C.length===0)return a;let i=null;for(const u of C)!i||i.lap_time_ms==null||u.lap_time_ms==null?a.set(u.lap_number,null):a.set(u.lap_number,u.lap_time_ms-i.lap_time_ms),i=u;return a},[C]),q="px-3 py-3 2xl:px-4 2xl:py-4",X="px-3 py-3 2xl:px-4 2xl:py-4",Xe=j.useMemo(()=>[{key:"lap_number",label:"Lap",headerClassName:`${q} w-16`,className:`${X} w-16 text-lg font-semibold text-slate-900 dark:text-white`,render:(a,i)=>i.lap_number??"—"},{key:"lap_time_ms",label:"Lap Time",headerClassName:q,className:`${X} text-lg`,render:(a,i)=>{const u=!!(F!=null&&F.fastestLap&&i.lap_time_ms&&F.fastestLap===i.lap_time_ms),N=!!(F!=null&&F.sessionFastestLap&&i.lap_time_ms&&F.sessionFastestLap===i.lap_time_ms);let L="text-slate-900 dark:text-white";return N?L="text-purple-600 dark:text-purple-400 font-semibold":u&&(L="text-green-600 dark:text-green-400 font-semibold"),t.jsx("span",{className:L,children:i.lap_time_ms!=null?G.formatTimeFromMs(i.lap_time_ms):"--:--.---"})}},{key:"delta",label:"Delta",headerClassName:q,className:`${X} text-lg font-medium`,render:(a,i)=>{const u=we.get(i.lap_number)??null;if(u===null)return t.jsx("span",{className:"text-slate-400",children:"--.---"});const N=u>0?"text-red-500":u<0?"text-green-500":"text-gray-500 dark:text-gray-400",L=u>0?"+":u<0?"-":"",O=de(Math.abs(u));return t.jsx("span",{className:N,children:`${L}${O}`})}},{key:"track_position",label:"Pos",headerClassName:`${q} w-16`,className:`${X} w-16 text-lg text-slate-900 dark:text-white`,render:(a,i)=>i.track_position??"—"},{key:"gap_to_leader_ms",label:"Gap",headerClassName:q,className:`${X} text-lg text-slate-900 dark:text-white`,render:(a,i)=>i.track_position===1?"Leader":i.gap_to_leader_ms&&i.gap_to_leader_ms>0?de(i.gap_to_leader_ms):"--.---"},{key:"gap_to_position_ahead_ms",label:"Interval",headerClassName:q,className:`${X} text-lg text-slate-900 dark:text-white`,render:(a,i)=>i.gap_to_position_ahead_ms&&i.gap_to_position_ahead_ms>0?de(i.gap_to_position_ahead_ms):"--.---"},{key:"tire_compound",label:"Tire",headerClassName:q,className:`${X} text-base`,render:(a,i)=>{if(!a)return t.jsx("span",{className:"text-lg text-gray-400 dark:text-gray-500",children:"--"});const u=G.getTireCompoundIcon(a),N=G.getTireCompoundText(a);return t.jsx("div",{className:"flex items-center justify-center gap-2 text-base text-gray-700 dark:text-gray-200",children:u?t.jsx("img",{src:u,alt:`${N} tire`,className:"h-5 w-5"}):t.jsx("span",{className:`font-medium ${o(a)}`,children:N})})}},{key:"sector1_ms",label:"S1",headerClassName:q,className:`${X} text-lg font-medium`,render:a=>{const i=(F==null?void 0:F.bestSector1)!=null&&a!=null&&F.bestSector1===a;return t.jsx("span",{className:i?"text-green-500":"text-slate-900 dark:text-white",children:me(a)})}},{key:"sector2_ms",label:"S2",headerClassName:q,className:`${X} text-lg font-medium`,render:a=>{const i=(F==null?void 0:F.bestSector2)!=null&&a!=null&&F.bestSector2===a;return t.jsx("span",{className:i?"text-green-500":"text-slate-900 dark:text-white",children:me(a)})}},{key:"sector3_ms",label:"S3",headerClassName:q,className:`${X} text-lg font-medium`,render:a=>{const i=(F==null?void 0:F.bestSector3)!=null&&a!=null&&F.bestSector3===a;return t.jsx("span",{className:i?"text-green-500":"text-slate-900 dark:text-white",children:me(a)})}},{key:"status",label:"Status",headerClassName:q,className:`${X} text-center`,render:(a,i)=>{const u=[];return i.pit_stop&&u.push(t.jsx("span",{className:"px-2 py-0.5 rounded bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs font-semibold",children:"PIT"},"pit")),i.max_safety_car_status&&i.max_safety_car_status!=="NO_SAFETY_CAR"&&u.push(t.jsx("span",{className:"px-2 py-0.5 rounded bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 text-xs font-semibold",children:i.max_safety_car_status==="SAFETY_CAR"?"SC":i.max_safety_car_status==="VIRTUAL_SAFETY_CAR"?"VSC":i.max_safety_car_status},"sc")),i.vehicle_fia_flags&&i.vehicle_fia_flags!=="None"&&u.push(t.jsx("span",{className:"px-2 py-0.5 rounded bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 text-xs font-semibold",children:i.vehicle_fia_flags},"flag")),u.length===0?t.jsx("span",{className:"text-lg text-gray-400 dark:text-gray-500",children:"-"}):t.jsx("div",{className:"flex flex-col items-center space-y-1",children:u})}}],[we,de,me,o,F]);s==null||s.number;const Ze=(s==null?void 0:s.name)??"Driver data unavailable",Re=(s==null?void 0:s.team)??"Unknown Team";(s==null?void 0:s.racePosition)??(s==null||s.position);const Je=F!=null&&F.fastestLap&&F.fastestLap>0?G.formatTimeFromMs(F.fastestLap):"--:--.---";S==="race"&&(s==null||s.raceTime);const fe=f(Re),Qe=fe?fe.trim().startsWith("#")?`radial-gradient(circle at top, ${fe}55, transparent 68%)`:`radial-gradient(circle at top, ${fe}, transparent 68%)`:"radial-gradient(circle at top, rgba(255,255,255,0.28), transparent 68%)",et=(p==null?void 0:p.eventName)||((Ce=p==null?void 0:p.track)==null?void 0:Ce.name)||((Le=p==null?void 0:p.race)==null?void 0:Le.name)||"Event",tt=j.useCallback(a=>{w(a),c(null)},[]),te=[.22,1,.36,1];return t.jsxs("div",{className:"relative -mt-24 -ml-[calc(50vw-50%)] -mr-[calc(50vw-50%)] w-screen overflow-hidden",children:[t.jsx("div",{className:"pointer-events-none absolute inset-0",children:t.jsx("div",{className:"absolute inset-x-0 top-0 h-[520px] blur-[160px]",style:{background:Qe}})}),t.jsxs(se.div,{className:"relative z-10 mx-auto max-w-[1600px] space-y-8 px-6 pt-40 pb-16 text-slate-900 dark:text-slate-100 lg:px-10",initial:{opacity:0,y:32},animate:{opacity:1,y:0},transition:{duration:.6,ease:te},children:[t.jsxs(se.header,{className:"flex flex-col items-center justify-center space-y-4 text-center",initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.5,ease:te,delay:.1},children:[t.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.45em] text-slate-500 dark:text-slate-400",children:Ze}),t.jsx("h1",{className:"text-4xl font-black uppercase tracking-[0.18em] text-slate-900 dark:text-white sm:text-5xl",children:"Race Analysis"}),t.jsx("span",{className:"text-sm font-medium uppercase tracking-[0.3em] text-slate-500 dark:text-slate-400",children:et})]}),t.jsxs(se.section,{className:"space-y-6",initial:{opacity:0,y:24},animate:{opacity:1,y:0},transition:{duration:.5,ease:te,delay:.18},children:[t.jsxs(se.nav,{className:"flex flex-col gap-4 border-b border-slate-200 pb-2 dark:border-slate-800 md:flex-row md:items-center md:justify-between","aria-label":"Tabs",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.45,ease:te,delay:.22},children:[t.jsxs("div",{className:"flex flex-wrap gap-3 sm:gap-4 lg:gap-6",children:[t.jsx("button",{onClick:()=>$("overview"),className:`pt-4 pb-2 px-1 border-b-2 font-medium text-base transition-colors ${T==="overview"?"border-red-600 text-red-600":"border-transparent text-gray-500 hover:text-gray-400 hover:border-gray-300"}`,children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Nt,{className:"w-4 h-4"}),t.jsx("span",{children:"Overview"})]})}),t.jsx("button",{onClick:()=>$("pace"),className:`pt-4 pb-2 px-1 border-b-2 font-medium text-base transition-colors ${T==="pace"?"border-red-600 text-red-600":"border-transparent text-gray-500 hover:text-gray-400 hover:border-gray-300"}`,children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(jt,{className:"w-4 h-4"}),t.jsx("span",{children:"Pace"})]})}),t.jsx("button",{onClick:()=>$("comparison"),className:`pt-4 pb-2 px-1 border-b-2 font-medium text-base transition-colors ${T==="comparison"?"border-red-600 text-red-600":"border-transparent text-gray-500 hover:text-gray-400 hover:border-gray-300"}`,children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Ee,{className:"w-4 h-4"}),t.jsx("span",{children:"Comparison"})]})}),t.jsx("button",{onClick:()=>$("strategy"),className:`pt-4 pb-2 px-1 border-b-2 font-medium text-base transition-colors ${T==="strategy"?"border-red-600 text-red-600":"border-transparent text-gray-500 hover:text-gray-400 hover:border-gray-300"}`,children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ct,{className:"w-4 h-4"}),t.jsx("span",{children:"Strategy"})]})})]}),t.jsx("div",{className:"w-full md:w-auto",children:r.length>1?t.jsx("select",{className:"rounded-xl border border-slate-200 bg-white px-3 py-1.5 text-sm font-medium text-slate-700 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-400/40",value:y??"",onChange:a=>tt(a.target.value||null),children:[...r].filter(a=>!!(a!=null&&a.sessionId)).sort((a,i)=>{const u={race:0,qualifying:1,practice:2},N=K(a.sessionType),L=K(i.sessionType);return u[N]!==u[L]?u[N]-u[L]:a.sessionType!==i.sessionType?i.sessionType-a.sessionType:0}).map(a=>t.jsx("option",{value:a.sessionId,disabled:!a.driver,children:a.sessionName||a.sessionTypeName||"Session"},a.sessionId))}):t.jsxs("span",{className:"inline-flex items-center justify-center rounded-full border border-slate-200 px-3 py-1 text-sm font-medium text-slate-600 dark:border-slate-700 dark:text-slate-300",children:["Session: ",E]})})]}),t.jsxs(se.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,y:-12},transition:{duration:.4,ease:te},className:"space-y-6",children:[T==="overview"&&t.jsx(Gt,{raceStats:F,sessionLabel:E,sessionKind:S,formatGapTime:de,formatSectorTime:me,getTireCompoundColor:o}),T==="pace"&&t.jsx(Yt,{driverName:(s==null?void 0:s.name)??"Driver",lapData:C,sessionDrivers:A,formatSecondsValue:ce,getTeamColorHex:f,pitLaps:M,primaryDriverId:s?(s==null?void 0:s.id)??(s==null?void 0:s.driver_id)??(s==null?void 0:s.driverId)??(s==null?void 0:s.member_id)??null:null}),T==="comparison"&&t.jsx(Wt,{driverName:(s==null?void 0:s.name)??"Driver",comparisonDriverName:oe,comparisonDriverId:k,onSelectComparisonDriver:c,comparisonOptions:H,lapComparisonData:ue,deltaComparisonData:xe,formatSecondsValue:ce,formatSecondsDifference:ve,overlayLegendItems:Ve,chartOverlays:Pe,LapTimeTooltipContent:Ge,DeltaTooltipContent:We,hexToRgba:qe,pitReferenceLines:U}),T==="strategy"&&t.jsx(Ht,{averageLapSeconds:Ye,compoundLineSetup:be,stintLines:Be,stintSegments:Ue,compoundAverages:Oe,formatSecondsValue:ce,StintLapTooltip:ze,CompoundBarTooltip:He,pitReferenceLines:U})]},T),t.jsxs(se.div,{className:"space-y-4",initial:{opacity:0,y:28},animate:{opacity:1,y:0},transition:{duration:.55,ease:te,delay:.26},children:[t.jsxs(se.div,{className:"flex items-center justify-between text-slate-900 dark:text-slate-100",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.45,ease:te,delay:.32},children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Lap Times"}),C.length>0&&t.jsxs("span",{className:"text-sm text-slate-500 dark:text-slate-400",children:[C.length," laps recorded"]})]}),t.jsx(se.div,{initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{duration:.5,ease:te,delay:.36},children:t.jsx(dt,{columns:Xe,rows:C,rowKey:a=>a.lap_number,emptyMessage:"No lap data available"})})]})]})]})]})};export{Rt as DriverRaceAnalysis};
//# sourceMappingURL=DriverRaceAnalysis-CeqWy6um.js.map
