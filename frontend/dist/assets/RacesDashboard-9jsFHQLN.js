import{e as Z,r as n,f as z,c as H,l as J,h as Q,j as e,i as W,d as ee,k as h,b as te,D as se}from"./index-446XYAQp.js";import{a as ae}from"./dateUtils-FAdOJ6Uu.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=Z("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),U=a=>{if(!a)return"TBD";const i=new Date(a);if(Number.isNaN(i.getTime()))return"TBD";const u=i.toLocaleDateString("en-US",{weekday:"short"}),g=ae(a);return`${u}, ${g}`},G=a=>a?a.split(", "):["Race"],V=a=>{const i=a.toLowerCase();return i.includes("practice")?"bg-emerald-500/15 text-emerald-400":i.includes("qualifying")?"bg-sky-500/15 text-sky-400":i.includes("race")?"bg-red-500/15 text-red-400":"bg-slate-500/10 text-slate-500"},re={completed:{label:"Completed",textClass:"text-emerald-400",dotClass:"bg-emerald-400"},cancelled:{label:"Cancelled",textClass:"text-red-400",dotClass:"bg-red-400"},scheduled:{label:"Scheduled",textClass:"text-amber-400",dotClass:"bg-amber-400"}},O=a=>re[a??"scheduled"],ie=({seasonId:a,onRaceSelect:i})=>{const[u,g]=n.useState([]),[C,y]=n.useState(!0),[j,I]=n.useState(null),[v,E]=n.useState("cards"),{isAuthenticated:N}=z(),[c,$]=n.useState(!1),[L,S]=n.useState(null),[p,F]=n.useState(null),[k,A]=n.useState({}),P=n.useRef(null);n.useEffect(()=>{N||$(!1)},[N]),n.useEffect(()=>{c||(S(null),F(null))},[c]);const D=n.useCallback(async()=>{try{y(!0);const t=await H(`/api/seasons/${a}/events`);if(t.ok){const l=((await t.json()).events||[]).slice().sort((x,m)=>{const o=x.order_index??Number.MAX_SAFE_INTEGER,d=m.order_index??Number.MAX_SAFE_INTEGER;if(o!==d)return o-d;const f=x.race_date?Date.parse(x.race_date):Number.POSITIVE_INFINITY,w=m.race_date?Date.parse(m.race_date):Number.POSITIVE_INFINITY;return f!==w?f-w:x.created_at.localeCompare(m.created_at)});g(l),A({})}else throw new Error("Failed to load events")}catch(t){J.error("Error loading events:",t),I(t instanceof Error?t.message:"Failed to load events")}finally{y(!1)}},[a]);n.useEffect(()=>{D()},[a,D]);const{latestCompleted:b,remainingCompleted:M,scheduledEvents:T,orderedEvents:R}=n.useMemo(()=>{const t=[],r=[];u.forEach(o=>{o.status==="completed"?r.push(o):t.push(o)});const s=r.slice().sort((o,d)=>{const f=o.race_date?Date.parse(o.race_date):Number.NEGATIVE_INFINITY,w=d.race_date?Date.parse(d.race_date):Number.NEGATIVE_INFINITY;if(f!==w)return w-f;const q=o.order_index??Number.MAX_SAFE_INTEGER,K=d.order_index??Number.MAX_SAFE_INTEGER;return q-K}),[l,...x]=s,m=l?[l,...t,...x]:[...t,...x];return{latestCompleted:l??null,remainingCompleted:x,scheduledEvents:t,orderedEvents:m}},[u]),_=n.useCallback(t=>{var r;p||(A(s=>{if(!s[t])return s;const l={...s};return delete l[t],l}),S(t),(r=P.current)==null||r.click())},[p]),X=n.useCallback(async t=>{var x;const r=t.target,s=(x=r.files)==null?void 0:x[0],l=L;if(!s||!l){r.value="";return}F(l);try{const m=new FormData;m.append("resultsFile",s);const o=await Q(`/api/seasons/${a}/events/${l}/upload`,m);if(!o.ok){const d=await o.json().catch(()=>({})),f=(d==null?void 0:d.error)||(Array.isArray(d==null?void 0:d.details)?d.details.join(", "):d==null?void 0:d.details)||"Failed to upload results";throw new Error(f)}await D()}catch(m){A(o=>({...o,[l]:m instanceof Error?m.message:"Failed to upload results"}))}finally{F(null),S(null),r.value=""}},[L,a,D]),Y=n.useMemo(()=>{const t=[{key:"track_name",label:"Event",align:"left",headerClassName:"text-left",className:"font-semibold text-slate-900 dark:text-slate-100",render:(r,s)=>s.short_event_name||s.event_name||s.track_name||"TBD"},{key:"track-info",label:"Circuit",align:"left",headerClassName:"text-left",render:(r,s)=>{var l,x;return e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:[e.jsx("div",{children:((l=s.track)==null?void 0:l.name)||"Venue TBD"}),e.jsx("div",{children:(x=s.track)!=null&&x.length?`${s.track.length} km`:"Distance TBD"})]})}},{key:"laps",label:"Total Laps",render:(r,s)=>e.jsx("span",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100",children:s.total_laps!=null?s.total_laps:s.session_duration?`${s.session_duration} laps`:"Laps TBD"})},{key:"race_date",label:"Date",render:(r,s)=>e.jsx("span",{className:"text-sm text-slate-400 dark:text-slate-500",children:U(s.race_date)})},{key:"session_types",label:"Sessions",render:(r,s)=>e.jsx("div",{className:"flex flex-wrap gap-2",children:G(s.session_types).map(l=>e.jsx("span",{className:h("inline-flex items-center rounded-full px-2.5 py-0.5 text-[11px] 2xl:text-sm font-semibold",V(l)),children:l},l))})},{key:"status",label:"Status",render:(r,s)=>{const l=O(s.status);return e.jsxs("span",{className:h("inline-flex items-center gap-2 text-sm font-semibold",l.textClass),children:[e.jsx("span",{className:h("h-2 w-2 rounded-full",l.dotClass)}),l.label]})}}];return c&&t.push({key:"upload_action",label:"Upload",align:"right",headerClassName:"text-right",render:(r,s)=>e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("button",{type:"button",onClick:l=>{l.preventDefault(),l.stopPropagation(),_(s.id)},disabled:p===s.id,className:"rounded-lg border border-slate-300 px-3 py-1.5 text-sm font-medium text-slate-600 transition-colors hover:bg-slate-200 disabled:cursor-not-allowed disabled:opacity-60 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800",children:p===s.id?"Uploading…":"Upload Results"}),k[s.id]&&e.jsx("span",{className:"max-w-[220px] text-xs text-red-500 dark:text-red-400",children:k[s.id]})]})}),t},[c,_,p,k]);return C?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Schedule"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"h-10 w-20 bg-gray-200 dark:bg-gray-700 rounded-lg animate-pulse"}),e.jsx("div",{className:"h-10 w-20 bg-gray-200 dark:bg-gray-700 rounded-lg animate-pulse"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((t,r)=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded mb-4"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded mb-4"}),e.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded"})]},r))})]}):j?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800",children:j})}):e.jsxs(W,{hero:{imageSrc:"/raw/images/M12_5309-Aangepast.jpg",title:"Season Schedule",subtitle:u.length?`${u.length} Events`:"Season Calendar",description:"Track every race weekend, session type, and status update across the entire campaign."},children:[e.jsx("input",{ref:P,type:"file",accept:".json",className:"hidden",onChange:X}),e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center text-slate-900 dark:text-slate-100",children:e.jsx(ee,{className:"h-6 w-6"})}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100",children:"Season Schedule"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex rounded-lg bg-slate-100 p-1 text-sm dark:bg-slate-900",children:[e.jsx("button",{onClick:()=>E("cards"),className:h("rounded-md px-3 py-1 transition-colors",v==="cards"?"bg-red-600 text-white":"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200"),children:"Grid"}),e.jsx("button",{onClick:()=>E("list"),className:h("rounded-md px-3 py-1 transition-colors",v==="list"?"bg-red-600 text-white":"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200"),children:"List"})]}),N&&e.jsx("button",{type:"button",onClick:()=>$(t=>!t),disabled:!!p,className:"rounded-lg border border-slate-300 px-3 py-1.5 text-sm font-medium text-slate-600 transition-colors hover:bg-slate-200 disabled:cursor-not-allowed disabled:opacity-60 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800",children:c?"Done":"Edit"})]})]}),u.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(te,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No events scheduled"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Events will appear here once they are added to the season."})]}):e.jsx(e.Fragment,{children:v==="cards"?e.jsxs("div",{className:"space-y-10",children:[b&&e.jsxs("section",{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-slate-100",children:"Latest Result"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:(()=>{const t=U(b.race_date);return t==="TBD"?"Awaiting final date":t})()})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:e.jsx(B,{event:b,onRaceSelect:i,isEditing:c,onUploadResults:_,uploading:p===b.id,uploadError:k[b.id]},b.id)})]}),T.length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-slate-100",children:"Upcoming & Scheduled"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:[T.length," event",T.length===1?"":"s"," remaining"]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:T.map(t=>e.jsx(B,{event:t,onRaceSelect:i,isEditing:c,onUploadResults:_,uploading:p===t.id,uploadError:k[t.id]},t.id))})]}),M.length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-slate-100",children:"Earlier Completed Events"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:[M.length+(b?1:0)," completed"]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:M.map(t=>e.jsx(B,{event:t,onRaceSelect:i,isEditing:c,onUploadResults:_,uploading:p===t.id,uploadError:k[t.id]},t.id))})]})]}):e.jsx(se,{columns:Y,rows:R,rowKey:t=>t.id,onRowClick:!c&&i?t=>i(t.id):void 0,emptyMessage:"No events scheduled."})})]})},B=({event:a,onRaceSelect:i,isEditing:u=!1,onUploadResults:g,uploading:C=!1,uploadError:y})=>{var E,N;const j=O(a.status),I=G(a.session_types),v=()=>{u||i==null||i(a.id)};return e.jsxs("div",{className:h("flex h-full flex-col overflow-hidden rounded-3xl border border-slate-200 bg-white shadow-md dark:border-slate-800 dark:bg-slate-950/70",u?"cursor-default opacity-100":"cursor-pointer transition hover:-translate-y-1 hover:shadow-xl"),onClick:v,children:[e.jsx("div",{className:"flex items-center justify-between border-b border-slate-200 px-6 py-4 dark:border-slate-800 dark:bg-slate-900/70",children:e.jsxs("div",{className:"flex items-center justify-between w-full gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:a.short_event_name||a.event_name||a.track_name||"TBD"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:U(a.race_date)})]})]}),e.jsxs("span",{className:h("inline-flex items-center gap-2 text-[11px] 2xl:text-xs font-semibold uppercase tracking-[0.28em]",j.textClass),children:[e.jsx("span",{className:h("h-2 w-2 rounded-full",j.dotClass)}),j.label]})]})}),e.jsxs("div",{className:"flex flex-col gap-4 px-6 py-5 text-sm 2xl:text-base text-slate-600 dark:text-slate-300",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400 dark:text-slate-500",children:"Track Information"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-sm 2xl:text-base text-slate-600 dark:text-slate-300",children:[e.jsx("li",{children:((E=a.track)==null?void 0:E.name)||"Venue TBD"}),e.jsx("li",{children:(N=a.track)!=null&&N.length?`${a.track.length} km`:"Distance TBD"}),e.jsx("li",{children:a.total_laps!=null?`${a.total_laps} laps`:a.session_duration?`${a.session_duration} laps`:"Laps TBD"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400 dark:text-slate-500",children:"Session Types"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:I.map(c=>e.jsx("span",{className:h("inline-flex items-center rounded-full px-2 py-0.5 text-[10px] 2xl:text-xs font-semibold uppercase tracking-[0.2em]",V(c)),children:c},c))})]})]}),u&&e.jsxs("div",{className:"border-t border-slate-200 px-6 py-4 dark:border-slate-800 dark:bg-slate-900/60",children:[e.jsx("button",{type:"button",onClick:c=>{c.preventDefault(),c.stopPropagation(),g==null||g(a.id)},disabled:C,className:"rounded-lg border border-slate-300 px-3 py-1.5 text-sm font-medium text-slate-600 transition-colors hover:bg-slate-200 disabled:cursor-not-allowed disabled:opacity-60 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800",children:C?"Uploading…":"Upload Results"}),y&&e.jsx("p",{className:"mt-2 text-xs text-red-500 dark:text-red-400",children:y})]})]})};export{ie as RacesDashboard};
//# sourceMappingURL=RacesDashboard-9jsFHQLN.js.map
