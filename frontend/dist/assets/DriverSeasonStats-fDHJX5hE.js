import{u as fe,a as he,r as n,F as S,T as ge,b as be,A as Ne,c as je,j as t,m as A,L as X,D as ke,C as Pe,S as we,B as v}from"./index-446XYAQp.js";import{T as Ce,B as ve}from"./BaseLineChart-Db_YwLwK.js";import{g as Le}from"./f123DataMapping-DL4nWXCf.js";import{f as De,a as Fe}from"./dateUtils-FAdOJ6Uu.js";import"./tiny-invariant-CH88cG8v.js";const Me=({label:a})=>t.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-slate-900/80 px-3 py-1 text-xs font-semibold text-slate-100",children:[t.jsx(we,{className:"h-3 w-3 text-amber-400"}),a]}),$e=(a,f)=>{if(!a)return`R${f+1}`;if(a.shortEventName)return a.shortEventName;if(a.eventName){const c=a.eventName.toLowerCase().indexOf(" grand prix");return c>0?`${a.eventName.slice(0,c)} GP`:a.eventName}return a.trackName?a.trackName:`R${f+1}`},Ie=a=>({raceId:(a==null?void 0:a.raceId)??(a==null?void 0:a.race_id)??"",trackName:(a==null?void 0:a.trackName)??(a==null?void 0:a.track_name)??null,raceDate:(a==null?void 0:a.raceDate)??(a==null?void 0:a.race_date)??null,position:(a==null?void 0:a.position)!==void 0&&(a==null?void 0:a.position)!==null?Number(a.position):null,gridPosition:(a==null?void 0:a.gridPosition)!==void 0&&(a==null?void 0:a.gridPosition)!==null?Number(a.gridPosition):null,points:(a==null?void 0:a.points)!==void 0&&(a==null?void 0:a.points)!==null?Number(a.points):null,fastestLap:!!(a!=null&&a.fastestLap),polePosition:!!(a!=null&&a.polePosition),resultStatus:(a==null?void 0:a.resultStatus)!==void 0&&(a==null?void 0:a.resultStatus)!==null?Number(a.resultStatus):null,raceStatus:(a==null?void 0:a.raceStatus)??null,sessionName:(a==null?void 0:a.sessionName)??null}),Te=a=>a===1?"text-yellow-400 bg-yellow-500/15":a===2?"text-gray-200 bg-gray-400/20":a===3?"text-amber-500 bg-amber-500/20":a&&a>0&&a<=10?"text-emerald-400 bg-emerald-500/15":"text-slate-300 bg-slate-700/30",He=a=>a?a.split(",").map(f=>f.trim()).filter(Boolean):[],qe=({driverId:a,onRaceSelect:f})=>{const{currentSeason:r}=fe(),{analysis:c,loading:Z,error:B}=he(r==null?void 0:r.id),[N,L]=n.useState([]),[D,_]=n.useState(!1),[F,M]=n.useState(null),[d,E]=n.useState(""),[$,y]=n.useState({}),[ee,I]=n.useState(!1),[R,T]=n.useState(null),i=n.useMemo(()=>c?c.drivers.find(s=>s.id===a)??null:null,[c,a]),q=n.useMemo(()=>{if(!c||!i)return[];const s=[],{highlights:e}=c.summary,l=(o,x)=>{(o==null?void 0:o.id)===i.id&&s.push(x)};return l(e.mostWins,"Season wins leader"),l(e.mostPodiums,"Podium leader"),l(e.mostPoles,"Pole position leader"),l(e.mostFastestLaps,"Fastest lap leader"),l(e.bestAverageFinish,"Best average finish"),l(e.bestConsistency,"Most consistent"),s},[c,i]),se=i?S.getTeamDisplayName(i.team??void 0):"Unknown Team",h=i!=null&&i.team?S.getTeamColorHex(i.team):"",G=n.useMemo(()=>Math.max(((i==null?void 0:i.totalRaces)??0)-((i==null?void 0:i.dnfs)??0),0),[i==null?void 0:i.dnfs,i==null?void 0:i.totalRaces]),O=n.useMemo(()=>{if(!i)return[];const s=i.totalRaces>0?(i.points/i.totalRaces).toFixed(1):"0.0";return[{id:"championship",title:"Championship",icon:Ce,iconClasses:"bg-red-500/15 text-red-400",metrics:[{label:"Points",value:i.points.toLocaleString()},{label:"Position",value:i.position?`P${i.position}`:"—"},{label:"Wins",value:i.wins.toString()}]},{id:"podiums",title:"Podium Pace",icon:ge,iconClasses:"bg-yellow-500/15 text-yellow-400",metrics:[{label:"Podiums",value:i.podiums.toString()},{label:"Poles",value:i.polePositions.toString()},{label:"Fastest Laps",value:i.fastestLaps.toString()}]},{id:"consistency",title:"Consistency",icon:be,iconClasses:"bg-purple-500/15 text-purple-400",metrics:[{label:"Avg Finish",value:i.averageFinish?`P${i.averageFinish.toFixed(1)}`:"—"},{label:"Consistency",value:`${i.consistency.toFixed(1)}%`},{label:"Points Finishes",value:i.pointsFinishes.toString()}]},{id:"reliability",title:"Season Reliability",icon:Ne,iconClasses:"bg-emerald-500/15 text-emerald-400",metrics:[{label:"DNFs",value:i.dnfs.toString()},{label:"Clean Finishes",value:G.toString()},{label:"Pts / Race",value:s}]}]},[G,i]),j=n.useCallback(async s=>{if(!(r!=null&&r.id))return[];const e=await je(`/api/drivers/${s}/race-history?seasonId=${r.id}`);if(!e.ok)throw new Error("Failed to fetch race history");const l=await e.json();return(Array.isArray(l==null?void 0:l.raceHistory)?l.raceHistory:[]).map(Ie)},[r==null?void 0:r.id]);n.useEffect(()=>{let s=!1;if(!a||!(r!=null&&r.id)){L([]),M(null);return}return(async()=>{try{_(!0),M(null);const l=await j(a);s||L(l)}catch(l){s||(M(l instanceof Error?l.message:"Unable to load race history"),L([]))}finally{s||_(!1)}})(),()=>{s=!0}},[a,r==null?void 0:r.id,j]),n.useEffect(()=>{E(""),T(null),I(!1)},[a]),n.useEffect(()=>{let s=!1;return!d||!(r!=null&&r.id)||$[d]?void 0:((async()=>{try{I(!0),T(null);const l=await j(d);s||y(o=>({...o,[d]:l}))}catch(l){s||T(l instanceof Error?l.message:"Unable to load comparison data")}finally{s||I(!1)}})(),()=>{s=!0})},[d,r==null?void 0:r.id,$,j]);const k=n.useMemo(()=>{var s;return(s=c==null?void 0:c.events)!=null&&s.completed?[...c.events.completed].sort((e,l)=>{const o=e!=null&&e.raceDate?new Date(e.raceDate).getTime():Number.POSITIVE_INFINITY,x=l!=null&&l.raceDate?new Date(l.raceDate).getTime():Number.POSITIVE_INFINITY;return o-x}):[]},[c]);n.useMemo(()=>{var e,l;const s=new Map;return(l=(e=c==null?void 0:c.events)==null?void 0:e.all)==null||l.forEach(o=>{o!=null&&o.id&&s.set(o.id,o)}),s},[c]);const P=n.useMemo(()=>{const s=new Map;for(const e of N)e.raceId&&s.set(e.raceId,e);return s},[N]),Q=d?$[d]??[]:[],K=n.useMemo(()=>{const s=new Map;for(const e of Q)e.raceId&&s.set(e.raceId,e);return s},[Q]),ae=n.useMemo(()=>k.map(s=>{var x;const e=P.get(s.id??"")??null,l=(e==null?void 0:e.raceDate)??s.raceDate??null,o=He(s.sessionTypes);return{raceId:s.id??(e==null?void 0:e.raceId)??"",eventName:s.eventName??s.shortEventName??(e==null?void 0:e.trackName)??s.trackName??"Race",trackName:((x=s.track)==null?void 0:x.name)??s.trackName??(e==null?void 0:e.trackName)??"Track",date:l,points:(e==null?void 0:e.points)??null,position:(e==null?void 0:e.position)??null,gridPosition:(e==null?void 0:e.gridPosition)??null,fastestLap:(e==null?void 0:e.fastestLap)??!1,polePosition:(e==null?void 0:e.polePosition)??!1,resultStatus:(e==null?void 0:e.resultStatus)??null,raceStatus:(e==null?void 0:e.raceStatus)??s.status??null,sessionTypes:o}}),[k,P]),te=n.useMemo(()=>[{key:"eventName",label:"Event",align:"left",render:s=>t.jsx("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:s})},{key:"trackName",label:"Track",align:"left",render:s=>t.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:s})},{key:"date",label:"Date",align:"left",render:(s,e)=>t.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:De(e.date)})},{key:"position",label:"Result",align:"left",render:(s,e)=>{const l=Te(e.position),o=e.position!=null?`P${e.position}`:e.resultStatus!=null?Le(e.resultStatus):"—";return t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold ${l}`,children:o}),e.fastestLap&&t.jsx("span",{className:"inline-flex items-center rounded-full bg-purple-500/15 px-2 py-0.5 text-[10px] font-semibold uppercase text-purple-300",children:"FL"}),e.polePosition&&t.jsx("span",{className:"inline-flex items-center rounded-full bg-blue-500/15 px-2 py-0.5 text-[10px] font-semibold uppercase text-blue-300",children:"Pole"})]})}},{key:"gridPosition",label:"Grid",align:"left",render:(s,e)=>t.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:e.gridPosition!=null?`P${e.gridPosition}`:"—"})},{key:"raceStatus",label:"Status",align:"left",render:(s,e)=>t.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:e.raceStatus??"—"})},{key:"sessionTypes",label:"Sessions",align:"left",render:(s,e)=>t.jsx("div",{className:"flex flex-wrap gap-2",children:e.sessionTypes.length>0?e.sessionTypes.map(l=>t.jsx("span",{className:"rounded-full bg-slate-800 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-slate-300",children:l},`${e.raceId}-${l}`)):t.jsx("span",{className:"text-xs text-slate-500",children:"—"})})},{key:"points",label:"Points",align:"right",render:(s,e)=>t.jsx("span",{className:"font-semibold text-slate-900 dark:text-slate-100",children:e.points!=null?Number(e.points).toLocaleString():"—"})}],[]),m=n.useMemo(()=>k.map((s,e)=>{const l=P.get(s.id??"")??null,o=K.get(s.id??"")??null,x=s.eventName??s.shortEventName??(l==null?void 0:l.trackName)??s.trackName??`Race ${e+1}`;return{raceId:s.id??(l==null?void 0:l.raceId)??`race-${e}`,order:e+1,label:x,shortLabel:$e(s,e),date:(l==null?void 0:l.raceDate)??s.raceDate??null,racePosition:(l==null?void 0:l.position)??null,qualifyingPosition:(l==null?void 0:l.gridPosition)??null,comparisonRacePosition:(o==null?void 0:o.position)??null,comparisonQualifyingPosition:(o==null?void 0:o.gridPosition)??null}}),[k,P,K]),le=n.useMemo(()=>{let s=0,e=0;for(const l of m){const o=l.racePosition;o!==null&&Number.isFinite(o)&&(s+=o,e++)}return e===0?null:Math.round(s/e*10)/10},[m]),ie=n.useMemo(()=>{let s=0,e=0;for(const l of m){const o=l.qualifyingPosition;o!==null&&Number.isFinite(o)&&(s+=o,e++)}return e===0?null:Math.round(s/e*10)/10},[m]),V=n.useMemo(()=>{if(!c)return[];const s=[];for(const e of c.drivers)e.id!==a&&s.push({id:e.id,name:e.name,team:e.team??null});return s.sort((e,l)=>e.name.localeCompare(l.name))},[c,a]),u=n.useMemo(()=>!c||!d?null:c.drivers.find(s=>s.id===d)??null,[c,d]),oe=n.useCallback(s=>({active:e,payload:l})=>{if(!e||!l||l.length===0)return null;const o=l[0].payload,x=s==="race"?o.racePosition:o.qualifyingPosition,w=s==="race"?o.comparisonRacePosition:o.comparisonQualifyingPosition;return t.jsxs("div",{className:"rounded-md border border-slate-700 bg-slate-900 px-3 py-2 text-xs text-slate-200 shadow-lg",children:[t.jsx("div",{className:"font-semibold text-slate-100",children:o.label}),o.date&&t.jsx("div",{className:"text-slate-400",children:Fe(o.date)}),t.jsxs("div",{className:"mt-2 space-y-1",children:[t.jsxs("div",{children:[(i==null?void 0:i.name)??"Driver",": ",x!=null?`P${x}`:"—"]}),d&&t.jsxs("div",{children:[(u==null?void 0:u.name)??"Comparison",":"," ",w!=null?`P${w}`:"—"]})]})]})},[d,u==null?void 0:u.name,i==null?void 0:i.name]),W=u!=null&&u.team?S.getTeamColorHex(u.team):"",ne=h?h.trim().startsWith("#")?`radial-gradient(circle at top, ${h}55, transparent 68%)`:`radial-gradient(circle at top, ${h}, transparent 68%)`:"radial-gradient(circle at top, rgba(255,255,255,0.28), transparent 72%)",ce=h||v.primary,re=h||v.electric,de=W||v.purple,me=W||v.accent,ue=Z||D,U=N.length>0?N[0].raceId:null,xe=D||F?[]:ae,pe=D?t.jsxs("div",{className:"flex items-center justify-center gap-2 text-slate-500 dark:text-slate-400",children:[t.jsx(X,{className:"h-5 w-5 animate-spin"}),t.jsx("span",{children:"Loading race results…"})]}):F?t.jsx("div",{className:"text-sm text-rose-400",children:F}):"No completed races recorded for this season yet.",Y=s=>{const e=s==="race"?"racePosition":"qualifyingPosition",l=s==="race"?"comparisonRacePosition":"comparisonQualifyingPosition",o=[];m.forEach(p=>{const C=p[e],b=p[l];C!=null&&o.push(C),b!=null&&o.push(b)});const x=o.length?Math.max(...o,10):10,w=s==="race"?m.some(p=>p.racePosition!=null):m.some(p=>p.qualifyingPosition!=null),z=s==="race"?m.some(p=>p.comparisonRacePosition!=null):m.some(p=>p.comparisonQualifyingPosition!=null),J=[{dataKey:e,name:(i==null?void 0:i.name)??"Driver",stroke:s==="race"?ce:re,dot:!0,strokeWidth:2}];d&&z&&J.push({dataKey:l,name:(u==null?void 0:u.name)??"Comparison",stroke:s==="race"?de:me,strokeDasharray:"6 3",dot:!0,strokeWidth:2});const g=s==="race"?le:ie;return t.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-950/70 p-6",children:[t.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:s==="race"?"Race Finish Trend":"Qualifying Trend"}),t.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:m.length>0?`${m.length} events`:"Awaiting data"})]}),g!==null&&t.jsxs("div",{className:"rounded-full border border-slate-700 px-3 py-1 text-xs font-semibold text-slate-300",children:["Avg: P",g.toFixed(1)]})]}),w||d&&z?t.jsx("div",{className:"h-64 w-full",children:t.jsx(ve,{data:m,xKey:"order",lines:J,legend:!!d,yAxisProps:{domain:[Math.max(x,1)+.5,.5],reversed:!0,allowDecimals:!1},xTickFormatter:(p,C)=>{var b;return((b=m[C])==null?void 0:b.shortLabel)??""},yTickFormatter:p=>`P${Number(p).toFixed(0)}`,tooltipContent:oe(s),height:"100%",cartesianGrid:!0,referenceLines:g!==null?[{y:g,stroke:"white",strokeDasharray:"4 4",label:{position:"right",value:`Avg P${g.toFixed(1)}`,fill:"white"}}]:void 0})}):t.jsxs("div",{className:"flex h-64 items-center justify-center text-sm text-slate-500",children:["No ",s==="race"?"race":"qualifying"," data yet."]})]})};if(ue)return t.jsx("div",{className:"flex h-64 items-center justify-center",children:t.jsx("div",{className:"h-12 w-12 animate-spin rounded-full border-b-2 border-red-600"})});if(B)return t.jsxs("div",{className:"flex h-64 flex-col items-center justify-center text-sm text-red-500",children:[t.jsx("p",{children:"Unable to load driver analysis."}),t.jsx("p",{className:"mt-1 text-xs text-red-400",children:B})]});if(!c||!i)return t.jsx("div",{className:"flex h-64 items-center justify-center text-sm text-slate-500 dark:text-slate-400",children:"Driver analysis unavailable."});const H=[.22,1,.36,1];return t.jsxs("div",{className:"relative -mt-24 -ml-[calc(50vw-50%)] -mr-[calc(50vw-50%)] w-screen overflow-hidden",children:[t.jsx("div",{className:"pointer-events-none absolute inset-0",children:t.jsx("div",{className:"absolute inset-x-0 top-0 h-[520px] blur-[160px]",style:{background:ne}})}),t.jsxs(A.div,{className:"relative z-10 mx-auto max-w-[1600px] space-y-8 px-6 pt-40 pb-16 text-slate-900 dark:text-slate-100 lg:px-10",initial:{opacity:0,y:32},animate:{opacity:1,y:0},transition:{duration:.6,ease:H},children:[t.jsxs(A.header,{className:"flex flex-col items-center justify-center space-y-3 text-center",initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.5,ease:H,delay:.1},children:[t.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.45em] text-slate-500 dark:text-slate-400",children:"Season Overview"}),t.jsx("h1",{className:"text-4xl font-black uppercase tracking-[0.18em] text-slate-900 dark:text-white sm:text-5xl",children:i.name}),t.jsx("span",{className:"text-sm font-medium uppercase tracking-[0.3em] text-slate-500 dark:text-slate-400",children:se}),q.length>0&&t.jsx("div",{className:"mt-2 flex flex-wrap items-center justify-center gap-2",children:q.map(s=>t.jsx(Me,{label:s},s))})]}),t.jsxs(A.section,{className:"space-y-8",initial:{opacity:0,y:24},animate:{opacity:1,y:0},transition:{duration:.5,ease:H,delay:.18},children:[t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[t.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-slate-100",children:"Season Statistics"}),V.length>0&&t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("label",{className:"text-xs font-semibold uppercase tracking-[0.28em] text-slate-500",children:"Compare"}),t.jsxs("select",{value:d,onChange:s=>E(s.target.value),className:"min-w-[200px] rounded-xl border border-slate-700 bg-slate-900 px-3 py-2 text-sm font-medium text-slate-200 shadow-sm focus:border-slate-500 focus:outline-none focus:ring-2 focus:ring-slate-500/30",children:[t.jsx("option",{value:"",children:"Driver only"}),V.map(s=>t.jsxs("option",{value:s.id,children:[s.name,s.team?` • ${s.team}`:""]},s.id))]})]})]}),ee&&t.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400",children:[t.jsx(X,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Loading comparison data…"})]}),R&&t.jsx("div",{className:"rounded-xl border border-rose-500/40 bg-rose-500/10 px-3 py-2 text-xs text-rose-200",children:R}),O.length>0&&t.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-4",children:O.map(s=>{const e=s.icon;return t.jsxs("div",{className:"rounded-3xl border border-slate-200/40 bg-white/5 p-6 shadow-md backdrop-blur-lg dark:border-slate-800 dark:bg-slate-950/60",children:[t.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[t.jsx("div",{className:`flex h-10 w-10 items-center justify-center rounded-2xl ${s.iconClasses}`,children:t.jsx(e,{className:"h-5 w-5"})}),t.jsx("h3",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:s.title})]}),t.jsx("div",{className:"space-y-3",children:s.metrics.map(l=>t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-slate-500 dark:text-slate-400",children:l.label}),t.jsx("span",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:l.value})]},`${s.id}-${l.label}`))})]},s.id)})}),t.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[Y("race"),Y("qualifying")]})]}),t.jsx(ke,{title:"Season Race Results",subtitle:"Completed events for the current season",columns:te,rows:xe,rowKey:s=>s.raceId||s.eventName,onRowClick:f?s=>{s.raceId&&f(s.raceId)}:void 0,emptyMessage:pe,headerActions:U&&f?t.jsxs("button",{onClick:()=>f(U),className:"inline-flex items-center gap-2 rounded-full border border-slate-700 px-3 py-1 text-xs font-semibold text-slate-300 transition hover:border-slate-500 hover:text-slate-100",children:["View latest race",t.jsx(Pe,{className:"h-3 w-3"})]}):void 0})]})]})]})};export{qe as DriverSeasonStats};
//# sourceMappingURL=DriverSeasonStats-fDHJX5hE.js.map
